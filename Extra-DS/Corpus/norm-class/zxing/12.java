copyright zxing authors licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license google zxing qrcode detector google zxing not found exception notfoundexception google zxing result point resultpoint google zxing result point callback resultpointcallback google zxing common bit matrix bitmatrix java util vector attempts find alignment patterns code alignment patterns finder patterns smaller regular intervals image moment bottom alignment pattern simplified copy link finder pattern finder finderpatternfinder copied pasted stripped maximum performance duplicate code thread safe reentrant thread allocate object author sean owen alignment pattern finder alignmentpatternfinder bit matrix bitmatrix image vector possible centers possiblecenters start x startx start y starty width height module size modulesize cross check state count crosscheckstatecount result point callback resultpointcallback result point callback resultpointcallback creates finder portion image param image image search param start x startx left column start searching param start y starty top row start searching param width width region search param height height region search param module size modulesize estimated module size alignment pattern finder alignmentpatternfinder bit matrix bitmatrix image start x startx start y starty width height module size modulesize result point callback resultpointcallback result point callback resultpointcallback image image possible centers possiblecenters vector start x startx start x startx start y starty start y starty width width height height module size modulesize module size modulesize cross check state count crosscheckstatecount result point callback resultpointcallback result point callback resultpointcallback method attempts find bottom alignment pattern image bit messy pretty performance critical written fast foremost link alignment pattern alignmentpattern not found exception notfoundexception alignment pattern alignmentpattern find not found exception notfoundexception start x startx start x startx height height max j maxj start x startx width middle i middlei start y starty height black white black modules ratio tracks number black white black modules state count statecount i gen igen i gen igen height i gen igen search middle outwards middle i middlei i gen igen i gen igen i gen igen state count statecount state count statecount state count statecount start x startx white continued left start point max j maxj image current state currentstate max j maxj image black pixel current state currentstate counting black pixels state count statecount current state currentstate counting white pixels current state currentstate winner found pattern cross foundpatterncross state count statecount alignment pattern alignmentpattern confirmed handle possible center handlepossiblecenter state count statecount confirmed confirmed state count statecount state count statecount state count statecount state count statecount current state currentstate state count statecount current state currentstate white pixel current state currentstate counting black pixels current state currentstate state count statecount current state currentstate found pattern cross foundpatterncross state count statecount alignment pattern alignmentpattern confirmed handle possible center handlepossiblecenter state count statecount max j maxj confirmed confirmed guess possible centers possiblecenters is empty isempty alignment pattern alignmentpattern possible centers possiblecenters element at elementat not found exception notfoundexception get not found instance getnotfoundinstance count black white black pixels position figures location center black white black center from end centerfromend state count statecount state count statecount state count statecount param state count statecount count black white black pixels read iff proportions counts close ratios alignment patterns considered match found pattern cross foundpatterncross state count statecount module size modulesize module size modulesize max variance maxvariance module size modulesize math abs module size modulesize state count statecount max variance maxvariance horizontal scan finds potential alignment pattern method cross checks scanning vertically center alignment pattern proportion detected param start i starti row alignment pattern detected param center j centerj center appears cross alignment pattern param max count maxcount maximum reasonable number modules observed reading based horizontal scan vertical center alignment pattern link na n nan cross check vertical crosscheckvertical start i starti center j centerj max count maxcount original state count total originalstatecounttotal bit matrix bitmatrix image image max i maxi image get height getheight state count statecount cross check state count crosscheckstatecount state count statecount state count statecount state count statecount start counting center start i starti image center j centerj state count statecount max count maxcount state count statecount modules edge state count statecount max count maxcount na n nan image center j centerj state count statecount max count maxcount state count statecount state count statecount max count maxcount na n nan count center start i starti max i maxi image center j centerj state count statecount max count maxcount state count statecount max i maxi state count statecount max count maxcount na n nan max i maxi image center j centerj state count statecount max count maxcount state count statecount state count statecount max count maxcount na n nan state count total statecounttotal state count statecount state count statecount state count statecount math abs state count total statecounttotal original state count total originalstatecounttotal original state count total originalstatecounttotal na n nan found pattern cross foundpatterncross state count statecount center from end centerfromend state count statecount na n nan called horizontal scan finds alignment pattern cross check vertical scan successful pattern previous horizontal scan confirmed conclude alignment pattern param state count statecount reading module counts horizontal scan param row alignment pattern param alignment pattern row link alignment pattern alignmentpattern pattern alignment pattern alignmentpattern handle possible center handlepossiblecenter state count statecount state count total statecounttotal state count statecount state count statecount state count statecount center j centerj center from end centerfromend state count statecount center i centeri cross check vertical crosscheckvertical center j centerj state count statecount state count total statecounttotal is na n isnan center i centeri estimated module size estimatedmodulesize state count statecount state count statecount state count statecount max possible centers possiblecenters size max alignment pattern alignmentpattern center alignment pattern alignmentpattern possible centers possiblecenters element at elementat center module size center about equals aboutequals estimated module size estimatedmodulesize center i centeri center j centerj alignment pattern alignmentpattern center j centerj center i centeri estimated module size estimatedmodulesize hadn save result point resultpoint point alignment pattern alignmentpattern center j centerj center i centeri estimated module size estimatedmodulesize possible centers possiblecenters add element addelement point result point callback resultpointcallback result point callback resultpointcallback found possible result point foundpossibleresultpoint point