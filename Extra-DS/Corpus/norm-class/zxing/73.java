copyright zxing authors licensed apache license version license file compliance license copy license http apache org licenses license required applicable law agreed writing software distributed license distributed basis warranties conditions kind express implied license specific language governing permissions limitations license google zxing qrcode detector google zxing decode hint type decodehinttype google zxing not found exception notfoundexception google zxing result point resultpoint google zxing result point callback resultpointcallback google zxing common bit matrix bitmatrix google zxing common collections google zxing common comparator java util hashtable java util vector attempts find finder patterns code finder patterns square markers corners code thread safe reentrant thread allocate object author sean owen finder pattern finder finderpatternfinder center quorum pixel module times modules center min skip support version mobile clients max modules integer math shift bit matrix bitmatrix image vector possible centers possiblecenters has skipped hasskipped cross check state count crosscheckstatecount result point callback resultpointcallback result point callback resultpointcallback creates finder search image finder patterns param image image search finder pattern finder finderpatternfinder bit matrix bitmatrix image image finder pattern finder finderpatternfinder bit matrix bitmatrix image result point callback resultpointcallback result point callback resultpointcallback image image possible centers possiblecenters vector cross check state count crosscheckstatecount result point callback resultpointcallback result point callback resultpointcallback bit matrix bitmatrix get image getimage image vector get possible centers getpossiblecenters possible centers possiblecenters finder pattern info finderpatterninfo find hashtable hints not found exception notfoundexception try harder tryharder hints hints contains key containskey decode hint type decodehinttype harder max i maxi image get height getheight max j maxj image get width getwidth black white black white black modules ratio tracks number modules assume maximum version code support takes height image account center modules size smallest number pixels center skip harder versions dense i skip iskip max i maxi max modules i skip iskip min skip try harder tryharder i skip iskip min skip state count statecount i skip iskip max i maxi i skip iskip row black white values state count statecount state count statecount state count statecount state count statecount state count statecount current state currentstate max j maxj image black pixel current state currentstate counting white pixels current state currentstate state count statecount current state currentstate white pixel current state currentstate counting black pixels current state currentstate winner found pattern cross foundpatterncross state count statecount confirmed handle possible center handlepossiblecenter state count statecount confirmed start examining checking turned expensive didn improve performance i skip iskip has skipped hasskipped have multiply confirmed centers havemultiplyconfirmedcenters row skip rowskip find row skip findrowskip row skip rowskip state count statecount skip rows row confirmed center top presumed confirmed center bit full chance detecting entire width center finder pattern skip row skip rowskip state count statecount size center pattern conservative i skip iskip row skip rowskip state count statecount i skip iskip max j maxj state count statecount state count statecount state count statecount state count statecount state count statecount state count statecount state count statecount state count statecount current state currentstate clear start current state currentstate state count statecount state count statecount state count statecount state count statecount state count statecount shift counts state count statecount state count statecount state count statecount state count statecount state count statecount state count statecount state count statecount state count statecount current state currentstate state count statecount current state currentstate counting white pixels state count statecount current state currentstate found pattern cross foundpatterncross state count statecount confirmed handle possible center handlepossiblecenter state count statecount max j maxj confirmed i skip iskip state count statecount has skipped hasskipped have multiply confirmed centers havemultiplyconfirmedcenters finder pattern finderpattern pattern info patterninfo select best patterns selectbestpatterns result point resultpoint order best patterns orderbestpatterns pattern info patterninfo finder pattern info finderpatterninfo pattern info patterninfo count black white black white black pixels position figures location center center from end centerfromend state count statecount state count statecount state count statecount state count statecount param state count statecount count black white black white black pixels read iff proportions counts close ratios finder patterns considered match found pattern cross foundpatterncross state count statecount total module size totalmodulesize count state count statecount count total module size totalmodulesize count total module size totalmodulesize module size modulesize total module size totalmodulesize integer math shift max variance maxvariance module size modulesize variance proportions math abs module size modulesize state count statecount integer math shift max variance maxvariance math abs module size modulesize state count statecount integer math shift max variance maxvariance math abs module size modulesize state count statecount integer math shift max variance maxvariance math abs module size modulesize state count statecount integer math shift max variance maxvariance math abs module size modulesize state count statecount integer math shift max variance maxvariance get cross check state count getcrosscheckstatecount cross check state count crosscheckstatecount cross check state count crosscheckstatecount cross check state count crosscheckstatecount cross check state count crosscheckstatecount cross check state count crosscheckstatecount cross check state count crosscheckstatecount horizontal scan finds potential finder pattern method cross checks scanning vertically center finder pattern proportion detected param start i starti row finder pattern detected param center j centerj center appears cross finder pattern param max count maxcount maximum reasonable number modules observed reading based horizontal scan vertical center finder pattern link na n nan cross check vertical crosscheckvertical start i starti center j centerj max count maxcount original state count total originalstatecounttotal bit matrix bitmatrix image image max i maxi image get height getheight state count statecount get cross check state count getcrosscheckstatecount start counting center start i starti image center j centerj state count statecount na n nan image center j centerj state count statecount max count maxcount state count statecount modules edge state count statecount max count maxcount na n nan image center j centerj state count statecount max count maxcount state count statecount state count statecount max count maxcount na n nan count center start i starti max i maxi image center j centerj state count statecount max i maxi na n nan max i maxi image center j centerj state count statecount max count maxcount state count statecount max i maxi state count statecount max count maxcount na n nan max i maxi image center j centerj state count statecount max count maxcount state count statecount state count statecount max count maxcount na n nan finder pattern size original assume positive state count total statecounttotal state count statecount state count statecount state count statecount state count statecount state count statecount math abs state count total statecounttotal original state count total originalstatecounttotal original state count total originalstatecounttotal na n nan found pattern cross foundpatterncross state count statecount center from end centerfromend state count statecount na n nan link cross check vertical crosscheckvertical fact basically identical reads horizontally vertically cross cross check vertical cross check locate real center alignment pattern cross check horizontal crosscheckhorizontal start j startj center i centeri max count maxcount original state count total originalstatecounttotal bit matrix bitmatrix image image max j maxj image get width getwidth state count statecount get cross check state count getcrosscheckstatecount start j startj image center i centeri state count statecount na n nan image center i centeri state count statecount max count maxcount state count statecount state count statecount max count maxcount na n nan image center i centeri state count statecount max count maxcount state count statecount state count statecount max count maxcount na n nan start j startj max j maxj image center i centeri state count statecount max j maxj na n nan max j maxj image center i centeri state count statecount max count maxcount state count statecount max j maxj state count statecount max count maxcount na n nan max j maxj image center i centeri state count statecount max count maxcount state count statecount state count statecount max count maxcount na n nan finder pattern size original assume positive state count total statecounttotal state count statecount state count statecount state count statecount state count statecount state count statecount math abs state count total statecounttotal original state count total originalstatecounttotal original state count total originalstatecounttotal na n nan found pattern cross foundpatterncross state count statecount center from end centerfromend state count statecount na n nan called horizontal scan finds alignment pattern cross check vertical scan successful cross cross check horizontal scan needed locate real horizontal center pattern cases extreme skew succeeds finder pattern location list tracks number times location matched finder pattern additional find evidence location fact finder pattern center param state count statecount reading module counts horizontal scan param row finder pattern param finder pattern row finder pattern candidate time handle possible center handlepossiblecenter state count statecount state count total statecounttotal state count statecount state count statecount state count statecount state count statecount state count statecount center j centerj center from end centerfromend state count statecount center i centeri cross check vertical crosscheckvertical center j centerj state count statecount state count total statecounttotal is na n isnan center i centeri cross check center j centerj cross check horizontal crosscheckhorizontal center j centerj center i centeri state count statecount state count total statecounttotal is na n isnan center j centerj estimated module size estimatedmodulesize state count total statecounttotal max possible centers possiblecenters size max finder pattern finderpattern center finder pattern finderpattern possible centers possiblecenters element at elementat center module size center about equals aboutequals estimated module size estimatedmodulesize center i centeri center j centerj center increment count incrementcount result point resultpoint point finder pattern finderpattern center j centerj center i centeri estimated module size estimatedmodulesize possible centers possiblecenters add element addelement point result point callback resultpointcallback result point callback resultpointcallback found possible result point foundpossibleresultpoint point number rows safely skip scanning based finder patterns located cases position infer pattern lie point image find row skip findrowskip max possible centers possiblecenters size max finder pattern finderpattern first confirmed center firstconfirmedcenter max finder pattern finderpattern center finder pattern finderpattern possible centers possiblecenters element at elementat center get count getcount center quorum first confirmed center firstconfirmedcenter first confirmed center firstconfirmedcenter center confirmed centers skip resuming pattern worst difference difference coordinates centers find top left has skipped hasskipped math abs first confirmed center firstconfirmedcenter get x getx center get x getx math abs first confirmed center firstconfirmedcenter get y gety center get y gety iff finder patterns detected link center quorum times estimated module size candidates pretty have multiply confirmed centers havemultiplyconfirmedcenters confirmed count confirmedcount total module size totalmodulesize max possible centers possiblecenters size max finder pattern finderpattern pattern finder pattern finderpattern possible centers possiblecenters element at elementat pattern get count getcount center quorum confirmed count confirmedcount total module size totalmodulesize pattern get estimated module size getestimatedmodulesize confirmed count confirmedcount confirmed centers positive detect estimated module sizes vary arbitrarily total deviation average exceeds total module size estimates average total module size totalmodulesize max total deviation totaldeviation max finder pattern finderpattern pattern finder pattern finderpattern possible centers possiblecenters element at elementat total deviation totaldeviation math abs pattern get estimated module size getestimatedmodulesize average total deviation totaldeviation total module size totalmodulesize link finder pattern finderpattern list candidates detected link center quorum times module size differs average patterns not found exception notfoundexception finder patterns exist finder pattern finderpattern select best patterns selectbestpatterns not found exception notfoundexception start size startsize possible centers possiblecenters size start size startsize couldn find finder patterns not found exception notfoundexception get not found instance getnotfoundinstance filter outlier possibilities module size start size startsize afford possibilities choose total module size totalmodulesize square start size startsize size finder pattern finderpattern possible centers possiblecenters element at elementat get estimated module size getestimatedmodulesize total module size totalmodulesize size square size size average total module size totalmodulesize start size startsize std dev stddev math sqrt square start size startsize average average collections insertion sort insertionsort possible centers possiblecenters furthest from average comparator furthestfromaveragecomparator average limit math max average std dev stddev possible centers possiblecenters size possible centers possiblecenters size finder pattern finderpattern pattern finder pattern finderpattern possible centers possiblecenters element at elementat math abs pattern get estimated module size getestimatedmodulesize average limit possible centers possiblecenters remove element at removeelementat possible centers possiblecenters size size candidate points total module size totalmodulesize possible centers possiblecenters size total module size totalmodulesize finder pattern finderpattern possible centers possiblecenters element at elementat get estimated module size getestimatedmodulesize average total module size totalmodulesize possible centers possiblecenters size collections insertion sort insertionsort possible centers possiblecenters center comparator centercomparator average possible centers possiblecenters set size setsize finder pattern finderpattern finder pattern finderpattern possible centers possiblecenters element at elementat finder pattern finderpattern possible centers possiblecenters element at elementat finder pattern finderpattern possible centers possiblecenters element at elementat orders furthest average furthest from average comparator furthestfromaveragecomparator comparator average furthest from average comparator furthestfromaveragecomparator average compare object center object center math abs finder pattern finderpattern center get estimated module size getestimatedmodulesize average math abs finder pattern finderpattern center get estimated module size getestimatedmodulesize average orders link finder pattern finderpattern get count getcount descending center comparator centercomparator comparator average center comparator centercomparator average compare object center object center finder pattern finderpattern center get count getcount finder pattern finderpattern center get count getcount finder pattern finderpattern center get count getcount finder pattern finderpattern center get count getcount math abs finder pattern finderpattern center get estimated module size getestimatedmodulesize average math abs finder pattern finderpattern center get estimated module size getestimatedmodulesize average