copyright contributors rights reserved program accompanying materials terms eclipse license accompanies distribution http eclipse org legal epl html contributors adrian colyer initial implementation org aspectj bridge context java lang weak reference weakreference java util hash map hashmap java util iterator java util map java util stack author colyer responsible tracking progress phases compilation weaving exception occurs message issued desired stack trace compiler time trace matching pointcut xyz matching shadow sss weaving type abc weaving shadow mungers thread local threadlocal work map thread context stack contextstack compilation and weaving context compilationandweavingcontext next token id nexttokenid unique constants phases registered front batch build incremental build processing compilation unit resolving compilation unit analysing compilation unit generating unwoven code compilation unit completing type bindings processing declare parents check imports connecting type hierarchy building fields methods collecting itds declares processing declare annotations weaving intertype declarations resolving pointcut declarations adding declare warnings errors validating aspectj annotations access inline adding aspectj annotations fixing calls itds fixing calls optimizing join point calls weaving processing reweavable processing type mungers weaving aspects weaving classes weaving type matching shadow implementing shadow matching pointcut munging processing ataspectjtype mungers phase names string phase names string batch building incrementally building processing compilation unit resolving types defined compilation unit analysing types defined compilation unit generating unwoven code type defined compilation unit completing type bindings processing declare parents checking setting imports connecting type hierarchy building fields methods collecting itds declares processing declare annotations weaving intertype declarations resolving pointcut declarations adding declare warning errors validating aspect j aspectj annotations creating accessors inlining adding aspect j aspectj annotations fixing calls itds context fixing calls itds optimizing this join point thisjoinpoint calls weaving processing reweavable processing type mungers weaving aspects weaving classes weaving type matching shadow implementing shadow matching pointcut type munging type munging aspect j aspectj aspect of aspectof context stacks thread map context map contextmap hash map hashmap single thread mode stack stack context stack contextstack stack formatters phase map formatter map formattermap hash map hashmap context formatter contextformatter default formatter defaultformatter default formatter defaultformatter multi threaded multithreaded service compilation and weaving context compilationandweavingcontext testing reset context map contextmap hash map hashmap context stack contextstack stack formatter map formattermap hash map hashmap next token id nexttokenid set multi threaded setmultithreaded multi threaded multithreaded register formatter registerformatter phase id phaseid context formatter contextformatter a formatter aformatter formatter map formattermap integer phase id phaseid a formatter aformatter returns string description compiler weaver string get current context getcurrentcontext stack context stack contextstack get context stack getcontextstack stack explanation stack explanationstack stack iterator iter context stack contextstack iterator iter has next hasnext context stack entry contextstackentry entry context stack entry contextstackentry iter object data entry get data getdata data explanation stack explanationstack push get formatter getformatter entry format entry formatentry entry phase id phaseid data string buffer stringbuffer string buffer stringbuffer explanation stack explanationstack is empty isempty append append explanation stack explanationstack pop to string tostring append to string tostring context token contexttoken entering phase enteringphase phase id phaseid object data stack context stack contextstack get context stack getcontextstack context token impl contexttokenimpl next token nexttoken next token nexttoken context stack contextstack push context stack entry contextstackentry next token nexttoken phase id phaseid weak reference weakreference data next token nexttoken exit phase stack entries token removed leaving phase leavingphase context token contexttoken a token atoken stack context stack contextstack get context stack getcontextstack context stack contextstack is empty isempty context stack entry contextstackentry entry context stack entry contextstackentry context stack contextstack pop entry context token contexttoken a token atoken stack get context stack getcontextstack multi threaded multithreaded context stack contextstack context map contextmap contains key containskey thread current thread currentthread stack context map contextmap thread current thread currentthread stack context stack contextstack stack context map contextmap thread current thread currentthread context stack contextstack context stack contextstack context token impl contexttokenimpl next token nexttoken context token impl contexttokenimpl next token id nexttokenid context formatter contextformatter get formatter getformatter context stack entry contextstackentry entry integer key integer entry phase id phaseid formatter map formattermap contains key containskey key context formatter contextformatter formatter map formattermap key default formatter defaultformatter context token impl contexttokenimpl context token contexttoken token id tokenid context token impl contexttokenimpl token id tokenid dumb data structure context stack entry contextstackentry context token impl contexttokenimpl context token contexttoken phase id phaseid weak reference weakreference data ref dataref context stack entry contextstackentry context token impl contexttokenimpl phase weak reference weakreference data context token contexttoken phase id phaseid phase data ref dataref data object get data getdata data ref dataref string to string tostring object data get data getdata data referenced context entry scope compilation and weaving context compilationandweavingcontext get formatter getformatter format entry formatentry phase id phaseid data default formatter defaultformatter context formatter contextformatter string format entry formatentry phase id phaseid object data string buffer stringbuffer string buffer stringbuffer append phase names phase id phaseid append data append string data append data to string tostring runtime exception runtimeexception append broken to string tostring data object to string tostring