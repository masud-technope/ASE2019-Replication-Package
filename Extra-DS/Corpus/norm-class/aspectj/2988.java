copyright ibm rights reserved program accompanying materials terms common license accompanies distribution http eclipse org legal cpl html contributors andy clement initial implementation org aspectj apache bcel classfile tests java file java util array list arraylist java util iterator java util list org aspectj apache bcel constants org aspectj apache bcel classfile java class javaclass org aspectj apache bcel classfile method org aspectj apache bcel classfile annotation annotation org aspectj apache bcel classfile annotation element name value pair elementnamevaluepair org aspectj apache bcel classfile annotation element value elementvalue org aspectj apache bcel aload org aspectj apache bcel astore org aspectj apache bcel array type arraytype org aspectj apache bcel class gen classgen org aspectj apache bcel constant pool gen constantpoolgen org aspectj apache bcel org aspectj apache bcel instruction constants instructionconstants org aspectj apache bcel instruction factory instructionfactory org aspectj apache bcel instruction handle instructionhandle org aspectj apache bcel instruction list instructionlist org aspectj apache bcel local variable gen localvariablegen org aspectj apache bcel method gen methodgen org aspectj apache bcel object type objecttype org aspectj apache bcel push org aspectj apache bcel type org aspectj apache bcel annotation annotation element value gen annotationelementvaluegen org aspectj apache bcel annotation annotation gen annotationgen org aspectj apache bcel annotation array element value gen arrayelementvaluegen org aspectj apache bcel annotation element name value pair gen elementnamevaluepairgen org aspectj apache bcel annotation element value gen elementvaluegen org aspectj apache bcel annotation simple element value gen simpleelementvaluegen org aspectj apache bcel util synthetic repository syntheticrepository program tests generate hello world helloworld main string argv buffered reader bufferedreader buffered reader bufferedreader input stream reader inputstreamreader system string andy ioexception system println generating annotated classes test generatingannotatedclassestest bcel test case bceltestcase set up setup exception set up setup steps test programmatically construct hello world helloworld program add simple annotations level save disk reload variant bcel classes check attributes test generate class level annotations testgenerateclasslevelannotations class not found exception classnotfoundexception create hello world helloworld class gen classgen create class gen createclassgen hello world helloworld constant pool gen constantpoolgen get constant pool getconstantpool instruction list instructionlist instruction list instructionlist add annotation addannotation create simple visible annotation createsimplevisibleannotation add annotation addannotation create simple invisible annotation createsimpleinvisibleannotation build class contents buildclasscontents dump class dumpclass hello world helloworld java class javaclass get class from getclassfrom hello world helloworld annotation get annotations getannotations assert true asserttrue annotations length length annotation annotation assert true asserttrue annotation simple annotation simpleannotation get type name gettypename get type name gettypename equals simple annotation simpleannotation assert true asserttrue annotation simple annotation simpleannotation get type name gettypename get type name gettypename equals simple annotation simpleannotation list vals get values getvalues element name value pair elementnamevaluepair nvp element name value pair elementnamevaluepair vals assert true asserttrue element simple annotation simpleannotation nvp get name string getnamestring nvp get name string getnamestring equals element value elementvalue nvp get value getvalue assert true asserttrue type element get element value type getelementvaluetype get element value type getelementvaluetype element value elementvalue primitive assert true asserttrue element stringify value stringifyvalue stringify value stringifyvalue equals assert true asserttrue create testdata file createtestdatafile hello world helloworld delete check dump method annotation read test generate method level annotations testgeneratemethodlevelannotations class not found exception classnotfoundexception create hello world helloworld class gen classgen create class gen createclassgen hello world helloworld constant pool gen constantpoolgen get constant pool getconstantpool instruction list instructionlist instruction list instructionlist build class contents with annotated methods buildclasscontentswithannotatedmethods check annotation get methods getmethods get annotations getannotations length assert true asserttrue prior dumping main method annotation dump class dumpclass temp file separator hello world helloworld java class javaclass get class from getclassfrom temp hello world helloworld check annotation get methods getmethods get annotations getannotations length assert true asserttrue java class javaclass annotation main method class gen classgen class gen classgen check class gen classgen method get methods getmethods get annotations getannotations length assert true asserttrue main method annotation method gen methodgen method gen methodgen get class name getclassname get constant pool getconstantpool check method changed method gen methodgen get annotations getannotations length assert true asserttrue main method gen methodgen annotation assert true asserttrue wipe temp file separator hello world helloworld test reload method change adding annotation store read verify annotations test generate method level annotations testgeneratemethodlevelannotations class not found exception classnotfoundexception create hello world helloworld class gen classgen create class gen createclassgen hello world helloworld constant pool gen constantpoolgen get constant pool getconstantpool instruction list instructionlist instruction list instructionlist build class contents with annotated methods buildclasscontentswithannotatedmethods dump class dumpclass temp hello world helloworld java class javaclass get class from getclassfrom temp hello world helloworld class gen classgen class gen classgen main method reading method main method mainmethod get methods getmethods assert true asserttrue method annotations main method mainmethod get annotations getannotations length main method mainmethod get annotations getannotations length method gen methodgen main method mainmethod method gen methodgen main method mainmethod get class name getclassname get constant pool getconstantpool assert true asserttrue method gen methodgen annotations main method mainmethod get annotations getannotations length main method mainmethod get annotations getannotations length main method mainmethod add annotation addannotation create fruit annotation createfruitannotation get constant pool getconstantpool pear remove method removemethod main method mainmethod add method addmethod main method mainmethod get method getmethod dump class dumpclass temp hello world helloworld java class javaclass get class from getclassfrom temp hello world helloworld class gen classgen class gen classgen method main method mainmethod get methods getmethods main method mainmethod get annotations getannotations length assert true asserttrue method annotations assert true asserttrue wipe temp hello world helloworld assert true asserttrue wipe temp hello world helloworld todo add delete file deletefile calls tests transform simple immutable mutable object test transform class to class gen testtransformclasstoclassgen simple types simpletypes class not found exception classnotfoundexception java class javaclass get class from getclassfrom testcode jar simple annotated class simpleannotatedclass class gen classgen cgen class gen classgen check annotations correctly preserved annotation gen annotationgen annotations cgen get annotations getannotations assert true asserttrue expected annotation annotations length annotations length transform simple immutable mutable object annotated annotation enum test transform class to class gen testtransformclasstoclassgen enum type enumtype class not found exception classnotfoundexception java class javaclass get class from getclassfrom testcode jar annotated with enum class annotatedwithenumclass class gen classgen cgen class gen classgen check annotations correctly preserved annotation gen annotationgen annotations cgen get annotations getannotations assert true asserttrue expected annotation annotations length annotations length transform simple immutable mutable object annotated annotation array simple annotations simpleannotations test transform class to class gen testtransformclasstoclassgen array and annotation types arrayandannotationtypes class not found exception classnotfoundexception java class javaclass get class from getclassfrom testcode jar annotated with combined annotation annotatedwithcombinedannotation class gen classgen cgen class gen classgen check annotations correctly preserved annotation gen annotationgen annotations cgen get annotations getannotations assert true asserttrue expected annotation annotations length annotations length annotation gen annotationgen annotations assert true asserttrue annotation get values getvalues size get values getvalues size element name value pair gen elementnamevaluepairgen nvp element name value pair gen elementnamevaluepairgen get values getvalues element value gen elementvaluegen element value gen elementvaluegen nvp get value getvalue assert true asserttrue array element value gen arrayelementvaluegen array element value gen arrayelementvaluegen array element value gen arrayelementvaluegen array value arrayvalue array element value gen arrayelementvaluegen assert true asserttrue array size array value arrayvalue get element values size getelementvaluessize array value arrayvalue get element values size getelementvaluessize element value gen elementvaluegen inner value innervalue element value gen elementvaluegen array value arrayvalue get element values getelementvalues assert true asserttrue array annotation element value gen annotationelementvaluegen inner value innervalue inner value innervalue annotation element value gen annotationelementvaluegen annotation element value gen annotationelementvaluegen inner annotation value innerannotationvalue annotation element value gen annotationelementvaluegen inner value innervalue assert true asserttrue called lsimple annotation lsimpleannotation called inner annotation value innerannotationvalue get annotation getannotation get type name gettypename inner annotation value innerannotationvalue get annotation getannotation get type signature gettypesignature equals lsimple annotation lsimpleannotation transform complex immutable mutable object test transform complex class to class gen testtransformcomplexclasstoclassgen class not found exception classnotfoundexception java class javaclass get class from getclassfrom testcode jar complex annotated class complexannotatedclass class gen classgen cgen class gen classgen check annotations correctly preserved annotation gen annotationgen annotations cgen get annotations getannotations assert true asserttrue expected annotation annotations length annotations length list annotations get values getvalues iterator iter iterator iter has next hasnext element name value pair gen elementnamevaluepairgen element element name value pair gen elementnamevaluepairgen iter element get name string getnamestring equals dval simple element value gen simpleelementvaluegen element get value getvalue stringify value stringifyvalue equals assert true asserttrue find annotation load modify attribute simple annotation simpleannotation annotation test modifying classes testmodifyingclasses class not found exception classnotfoundexception java class javaclass get class from getclassfrom testcode jar simple annotated class simpleannotatedclass class gen classgen cgen class gen classgen constant pool gen constantpoolgen cgen get constant pool getconstantpool cgen add annotation addannotation create fruit annotation createfruitannotation pineapple assert true asserttrue annotations cgen get annotations getannotations length cgen get annotations getannotations length dump class dumpclass cgen simple annotated class simpleannotatedclass assert true asserttrue wipe simple annotated class simpleannotatedclass load modify attribute complex annotation complexannotation annotation test modifying classes testmodifyingclasses class not found exception classnotfoundexception java class javaclass get class from getclassfrom testcode jar simple annotated class simpleannotatedclass class gen classgen cgen class gen classgen constant pool gen constantpoolgen cgen get constant pool getconstantpool cgen add annotation addannotation create combined annotation createcombinedannotation assert true asserttrue annotations cgen get annotations getannotations length cgen get annotations getannotations length dump class dumpclass cgen simple annotated class simpleannotatedclass java class javaclass get class from getclassfrom simple annotated class simpleannotatedclass get annotations getannotations assert true asserttrue wipe simple annotated class simpleannotatedclass system err println to string tostring dump class dumpclass class gen classgen string fname file create testdata file createtestdatafile fname get java class getjavaclass dump java ioexception system err println dump class dumpclass class gen classgen string dir string fname dump class dumpclass dir file separator fname build class contents with annotated methods buildclasscontentswithannotatedmethods class gen classgen constant pool gen constantpoolgen instruction list instructionlist create method main string argv method gen methodgen create method gen createmethodgen main instruction factory instructionfactory factory instruction factory instructionfactory add annotation addannotation create simple visible annotation createsimplevisibleannotation get constant pool getconstantpool define types object type objecttype stream object type objecttype java input stream inputstream object type objecttype stream object type objecttype java print stream printstream create variables call constructors execute buffered reader bufferedreader input stream reader inputstreamreader system reference buffered reader bufferedreader object stays top stack stored newly allocated variable append factory create new createnew java buffered reader bufferedreader predefined constant append instruction constants instructionconstants dup append factory create new createnew java input stream reader inputstreamreader append instruction constants instructionconstants dup append factory create field access createfieldaccess java lang system stream constants getstatic append factory create invoke createinvoke java input stream reader inputstreamreader init type type stream constants invokespecial append factory create invoke createinvoke java buffered reader bufferedreader init type type object type objecttype java reader constants invokespecial local variable gen localvariablegen add local variable addlocalvariable object type objecttype java buffered reader bufferedreader get index getindex valid set start setstart append astore create local variable initialize add local variable addlocalvariable type string get index getindex append instruction constants instructionconstants aconst valid set start setstart append astore create block remember start block read standard input store variable instruction handle instructionhandle start append factory create field access createfieldaccess java lang system stream constants getstatic append push enter append factory create invoke createinvoke java print stream printstream print type type type string constants invokevirtual append aload append factory create invoke createinvoke java buffered reader bufferedreader read line readline type string type args constants invokevirtual instruction handle instructionhandle start append push andy append astore normal execution jump exception handler target address instruction handle instructionhandle append add exception handler simply returns method local variable gen localvariablegen add local variable addlocalvariable type get type gettype ljava ioexception slot get index getindex instruction handle instructionhandle handler append astore slot set start setstart handler set end setend append instruction constants instructionconstants add exception handler addexceptionhandler start handler object type objecttype java ioexception normal code continues branch target instruction handle instructionhandle append factory create field access createfieldaccess java lang system stream constants getstatic set target settarget printing string concatenation compiles string buffer stringbuffer operations append factory create new createnew type stringbuffer append instruction constants instructionconstants dup append push append factory create invoke createinvoke java lang string buffer stringbuffer init type type type string constants invokespecial append aload append factory create invoke createinvoke java lang string buffer stringbuffer append type stringbuffer type type string constants invokevirtual append factory create invoke createinvoke java lang string buffer stringbuffer to string tostring type string type args constants invokevirtual append factory create invoke createinvoke java print stream printstream println type type type string constants invokevirtual append instruction constants instructionconstants finalization stack size computed fly add constructor method empty set max stack setmaxstack set max locals setmaxlocals add method addmethod get method getmethod instruction handles reused dispose add empty constructor addemptyconstructor constants acc build class contents buildclasscontents class gen classgen constant pool gen constantpoolgen instruction list instructionlist create method main string argv method gen methodgen create method gen createmethodgen main instruction factory instructionfactory factory instruction factory instructionfactory define types object type objecttype stream object type objecttype java input stream inputstream object type objecttype stream object type objecttype java print stream printstream create variables call constructors execute buffered reader bufferedreader input stream reader inputstreamreader system reference buffered reader bufferedreader object stays top stack stored newly allocated variable append factory create new createnew java buffered reader bufferedreader predefined constant append instruction constants instructionconstants dup append factory create new createnew java input stream reader inputstreamreader append instruction constants instructionconstants dup append factory create field access createfieldaccess java lang system stream constants getstatic append factory create invoke createinvoke java input stream reader inputstreamreader init type type stream constants invokespecial append factory create invoke createinvoke java buffered reader bufferedreader init type type object type objecttype java reader constants invokespecial local variable gen localvariablegen add local variable addlocalvariable object type objecttype java buffered reader bufferedreader get index getindex valid set start setstart append astore create local variable initialize add local variable addlocalvariable type string get index getindex append instruction constants instructionconstants aconst valid set start setstart append astore create block remember start block read standard input store variable instruction handle instructionhandle start append factory create field access createfieldaccess java lang system stream constants getstatic append push enter append factory create invoke createinvoke java print stream printstream print type type type string constants invokevirtual append aload append factory create invoke createinvoke java buffered reader bufferedreader read line readline type string type args constants invokevirtual instruction handle instructionhandle start append push andy append astore normal execution jump exception handler target address instruction handle instructionhandle append add exception handler simply returns method local variable gen localvariablegen add local variable addlocalvariable type get type gettype ljava ioexception slot get index getindex instruction handle instructionhandle handler append astore slot set start setstart handler set end setend append instruction constants instructionconstants add exception handler addexceptionhandler start handler object type objecttype java ioexception normal code continues branch target instruction handle instructionhandle append factory create field access createfieldaccess java lang system stream constants getstatic set target settarget printing string concatenation compiles string buffer stringbuffer operations append factory create new createnew type stringbuffer append instruction constants instructionconstants dup append push append factory create invoke createinvoke java lang string buffer stringbuffer init type type type string constants invokespecial append aload append factory create invoke createinvoke java lang string buffer stringbuffer append type stringbuffer type type string constants invokevirtual append factory create invoke createinvoke java lang string buffer stringbuffer to string tostring type string type args constants invokevirtual append factory create invoke createinvoke java print stream printstream println type type type string constants invokevirtual append instruction constants instructionconstants finalization stack size computed fly add constructor method empty set max stack setmaxstack set max locals setmaxlocals add method addmethod get method getmethod instruction handles reused dispose add empty constructor addemptyconstructor constants acc java class javaclass get class from getclassfrom string string clazzname class not found exception classnotfoundexception synthetic repository syntheticrepository repos create repos createrepos repos load class loadclass clazzname helper methods class gen classgen create class gen createclassgen string classname class gen classgen classname java lang object generated constants acc constants acc method gen methodgen create method gen createmethodgen string methodname instruction list instructionlist constant pool gen constantpoolgen method gen methodgen access flags constants acc constants acc type type argument types type array type arraytype type string arg names string argv method methodname method hello world helloworld annotation gen annotationgen create simple visible annotation createsimplevisibleannotation constant pool gen constantpoolgen simple element value gen simpleelementvaluegen evg simple element value gen simpleelementvaluegen element value gen elementvaluegen primitive element name value pair gen elementnamevaluepairgen nv gen nvgen element name value pair gen elementnamevaluepairgen evg object type objecttype object type objecttype simple annotation simpleannotation list elements array list arraylist elements add nv gen nvgen annotation gen annotationgen annotation gen annotationgen elements annotation gen annotationgen create fruit annotation createfruitannotation constant pool gen constantpoolgen string a fruit afruit simple element value gen simpleelementvaluegen evg simple element value gen simpleelementvaluegen element value gen elementvaluegen string a fruit afruit element name value pair gen elementnamevaluepairgen nv gen nvgen element name value pair gen elementnamevaluepairgen fruit evg object type objecttype object type objecttype simple string annotation simplestringannotation list elements array list arraylist elements add nv gen nvgen annotation gen annotationgen elements annotation gen annotationgen create combined annotation createcombinedannotation constant pool gen constantpoolgen create annotation instance annotation gen annotationgen create simple visible annotation createsimplevisibleannotation array element value gen arrayelementvaluegen array array element value gen arrayelementvaluegen array add element addelement annotation element value gen annotationelementvaluegen element name value pair gen elementnamevaluepairgen nvp element name value pair gen elementnamevaluepairgen array list elements array list arraylist elements add nvp annotation gen annotationgen object type objecttype combined annotation combinedannotation elements annotation gen annotationgen create simple invisible annotation createsimpleinvisibleannotation constant pool gen constantpoolgen simple element value gen simpleelementvaluegen evg simple element value gen simpleelementvaluegen element value gen elementvaluegen primitive element name value pair gen elementnamevaluepairgen nv gen nvgen element name value pair gen elementnamevaluepairgen evg object type objecttype object type objecttype simple annotation simpleannotation list elements array list arraylist elements add nv gen nvgen annotation gen annotationgen annotation gen annotationgen elements tear down teardown exception tear down teardown