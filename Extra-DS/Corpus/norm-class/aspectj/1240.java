copyright palo alto center incorporated parc rights reserved program accompanying materials terms common license accompanies distribution http eclipse org legal cpl html contributors parc initial implementation org aspectj weaver java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java data input stream datainputstream java data output stream dataoutputstream java ioexception java util array list arraylist java util collection java util collections java util hash set hashset java util iterator java util list java util java util zip zip entry zipentry java util zip zip input stream zipinputstream org aspectj bridge imessage org aspectj weaver bcel bcel type munger bceltypemunger weaver state info weaverstateinfo list entry type mungers typemungers old style oldstyle reweavable unwoven class file unwovenclassfile uncompressed read reweavable compressed mode reweavablecompressedmode unwoven class file unwovenclassfile written read diff reweavable diff mode reweavablediffmode exist reweaving valid string aspects affecting type aspectsaffectingtype original untouched file unwoven class file unwovenclassfile ajh changed reweavable default reweavabledefault reweavable compressed mode default reweavablecompressedmodedefault reweavable diff mode default reweavablediffmodedefault serializing weaver state info weaverstateinfo adding reweavable data add diff unwoven class file unwovenclassfile woven class file wovenclassfile don woven class file wovenclassfile process making key stub woven class file wovenclassfile replace key with diff replacekeywithdiff called key unwoven class file is adiff unwovenclassfileisadiff weaver state info weaverstateinfo array list arraylist reweavable default reweavabledefault reweavable compressed mode default reweavablecompressedmodedefault reweavable diff mode default reweavablediffmodedefault weaver state info weaverstateinfo reweavable array list arraylist reweavable reweavable compressed mode default reweavablecompressedmodedefault reweavable diff mode default reweavablediffmodedefault weaver state info weaverstateinfo list type mungers typemungers old style oldstyle reweavable mode reweavablemode reweavable compressed mode reweavablecompressedmode reweavable diff mode reweavablediffmode type mungers typemungers type mungers typemungers old style oldstyle old style oldstyle reweavable reweavable mode reweavablemode reweavable compressed mode reweavablecompressedmode reweavable compressed mode reweavablecompressedmode reweavable diff mode reweavablediffmode reweavable mode reweavablemode reweavable diff mode reweavablediffmode aspects affecting type aspectsaffectingtype hash set hashset unwoven class file unwovenclassfile set reweavable mode defaults setreweavablemodedefaults mode compress diff reweavable default reweavabledefault mode reweavable compressed mode default reweavablecompressedmodedefault compress reweavable diff mode default reweavablediffmodedefault diff untouched woven extended bits capabilities valid extended mode reweavable bit reweavable compression bit reweavable diff bit comments write weaver state info weaverstateinfo read versioned data input stream versioneddatainputstream isource context isourcecontext context ioexception read byte readbyte is reweavable isreweavable reweavable bit is reweavable isreweavable reweavable bit is reweavable compressed isreweavablecompressed reweavable compression bit is reweavable compressed isreweavablecompressed reweavable compression bit is reweavable diff isreweavablediff reweavable diff bit is reweavable diff isreweavablediff reweavable diff bit untouched runtime exception runtimeexception unexpected unwoven woven weaver state info weaverstateinfo collections empty list is reweavable isreweavable is reweavable compressed isreweavablecompressed is reweavable diff isreweavablediff extended read short readshort list array list arraylist unresolved type unresolvedtype aspect type aspecttype unresolved type unresolvedtype read resolved type munger resolvedtypemunger type munger typemunger resolved type munger resolvedtypemunger read context add entry aspect type aspecttype type munger typemunger weaver state info weaverstateinfo wsi weaver state info weaverstateinfo is reweavable isreweavable is reweavable compressed isreweavablecompressed is reweavable diff isreweavablediff read any reweavable data readanyreweavabledata wsi wsi runtime exception runtimeexception bad weaver state weaverstate kind entry unresolved type unresolvedtype aspect type aspecttype resolved type munger resolvedtypemunger type munger typemunger entry unresolved type unresolvedtype aspect type aspecttype resolved type munger resolvedtypemunger type munger typemunger aspect type aspecttype aspect type aspecttype type munger typemunger type munger typemunger string to string tostring aspect type aspecttype type munger typemunger serialize weaver state info weaverstateinfo bits kind flag structure attribute reweavable diff mode marker inserted start attribute calculated diff inserted key replaced diff kind moves front attribute read logic expecting kind write data output stream dataoutputstream ioexception old style oldstyle reweavable compressed mode reweavablecompressedmode runtime exception runtimeexception shouldn writing weaver state info kind weaverstateinfokind extended reweavable weaver state info kind weaverstateinfokind reweavable bit reweavable diff mode reweavablediffmode key replace diff write key weaver state info kind weaverstateinfokind reweavable diff bit write byte writebyte weaver state info kind weaverstateinfokind type mungers typemungers size write short writeshort entry entry type mungers typemungers aspect type aspecttype write type munger typemunger write write any reweavable data writeanyreweavabledata add concrete munger addconcretemunger concrete type munger concretetypemunger munger type mungers typemungers add entry munger get aspect type getaspecttype munger get munger getmunger string to string tostring weaver state info weaverstateinfo type mungers typemungers old style oldstyle list get type mungers gettypemungers resolved type resolvedtype on type ontype on type ontype get world getworld list ret array list arraylist iterator type mungers typemungers iterator has next hasnext entry entry entry resolved type resolvedtype aspect type aspecttype resolve entry aspect type aspecttype aspect type aspecttype is missing ismissing show message showmessage imessage error weaver messages weavermessages format weaver messages weavermessages aspect needed entry aspect type aspecttype on type ontype on type ontype get source location getsourcelocation ret add bcel type munger bceltypemunger entry type munger typemunger aspect type aspecttype ret is old style isoldstyle old style oldstyle get unwoven class file data getunwovenclassfiledata woven class file wovenclassfile unwoven class file is adiff unwovenclassfileisadiff unwoven class file unwovenclassfile apply diff applydiff woven class file wovenclassfile unwoven class file unwovenclassfile unwoven class file is adiff unwovenclassfileisadiff unwoven class file unwovenclassfile set unwoven class file data setunwovenclassfiledata data unwoven class file unwovenclassfile data is reweavable isreweavable reweavable set reweavable setreweavable reweavable add aspects affecting type addaspectsaffectingtype collection string aspects aspects affecting type aspectsaffectingtype add all addall aspects add aspect affecting type addaspectaffectingtype string aspect type aspecttype aspects affecting type aspectsaffectingtype add aspect type aspecttype get aspects affecting type getaspectsaffectingtype string aspects affecting type aspectsaffectingtype read any reweavable data readanyreweavabledata weaver state info weaverstateinfo wsi data input stream datainputstream ioexception wsi is reweavable isreweavable load list aspects exist reweaving legal number aspects affecting type numberaspectsaffectingtype read short readshort number aspects affecting type numberaspectsaffectingtype wsi add aspect affecting type addaspectaffectingtype read utf readutf unwoven class file size unwovenclassfilesize read int readint class data classdata unwoven class file unwovenclassfile compressed wsi reweavable compressed mode reweavablecompressedmode class data classdata unwoven class file size unwovenclassfilesize zip input stream zipinputstream zis zip input stream zipinputstream zip entry zipentry zen zis get next entry getnextentry current bytes to go bytestogo unwoven class file size unwovenclassfilesize bytes to go bytestogo amount zis read class data classdata current bytes to go bytestogo current amount bytes to go bytestogo amount zis close entry closeentry bytes to go bytestogo ioexception error reading compressed reweavable data expected unwoven class file size unwovenclassfilesize bytes current class data classdata unwoven class file size unwovenclassfilesize bytesread read class data classdata bytesread unwoven class file size unwovenclassfilesize ioexception error reading reweavable data expected unwoven class file size unwovenclassfilesize bytes bytesread diff mode diffmode remember apply diff asks unwoven class file unwovenclassfile wsi unwoven class file is adiff unwovenclassfileisadiff wsi reweavable diff mode reweavablediffmode wsi set unwoven class file data setunwovenclassfiledata class data classdata cleverness reweavable diff mode file disk weaverstateinfo attribute diff applied recover original rewoven replace key with diff replacekeywithdiff woven class file wovenclassfile reweavable diff mode reweavablediffmode byte array output stream bytearrayoutputstream array stream arraystream byte array output stream bytearrayoutputstream data output stream dataoutputstream data output stream dataoutputstream array stream arraystream end of key endofkey find end of key findendofkey woven class file wovenclassfile start of key startofkey end of key endofkey key length length wsi attribute written infront class file classfile swapping diff key change length wsi fiddle length bytes old length location oldlengthlocation start of key startofkey old length oldlength read int readint woven class file wovenclassfile old length location oldlengthlocation delete key woven class file wovenclassfile delete in array deleteinarray woven class file wovenclassfile start of key startofkey end of key endofkey woven class file up to wsi wovenclassfileuptowsi old length location oldlengthlocation system arraycopy woven class file wovenclassfile woven class file up to wsi wovenclassfileuptowsi old length location oldlengthlocation diff generate diff generatediff woven class file up to wsi wovenclassfileuptowsi unwoven class file unwovenclassfile length diff infront diff write int writeint diff length write diff ioexception diff array stream arraystream to byte array tobytearray swap old length oldlength add diff old length oldlength work new length newlength old length oldlength key length diff length new length bytes newlengthbytes serialize int serializeint new length newlength swap serialized new length newlength old one oldone woven class file wovenclassfile old length location oldlengthlocation new length bytes newlengthbytes woven class file wovenclassfile old length location oldlengthlocation new length bytes newlengthbytes woven class file wovenclassfile old length location oldlengthlocation new length bytes newlengthbytes woven class file wovenclassfile old length location oldlengthlocation new length bytes newlengthbytes add diff woven class file wovenclassfile insert array insertarray diff woven class file wovenclassfile old length location oldlengthlocation old length oldlength key length woven class file wovenclassfile find end of key findendofkey woven class file wovenclassfile classfile attributes woven class file wovenclassfile length end of key here endofkeyhere woven class file wovenclassfile happen runtime exception runtimeexception key woven class file wovenclassfile end of key here endofkeyhere look in lookin key length key key length look in lookin insert array insertarray to insert toinsert original offset result original length to insert toinsert length system arraycopy original result offset system arraycopy to insert toinsert result offset to insert toinsert length system arraycopy original offset result offset to insert toinsert length original length offset result read int readint offset byte array input stream bytearrayinputstream byte array input stream bytearrayinputstream offset data input stream datainputstream data input stream datainputstream length length read int readint ioexception runtime exception runtimeexception read int readint called bad array offset length delete in array deleteinarray start length to delete lengthtodelete start array result length length to delete lengthtodelete copy bit deleted bit system arraycopy result start copy bit deleted bit system arraycopy result start length result ajh quick note diff format classfiles consist bytes magic number minor major versions bytes constant pool count bytes file weaving classfile classfile bytes constant pool count bytes weaving didn change referred diff consists bytes constant pool count bytes length bytes unwoven class file unwovenclassfile generate diff generatediff woven class file wovenclassfile un woven class file unwovenclassfile find looking at lookingat shorter length shorterlength woven class file wovenclassfile length un woven class file unwovenclassfile length woven class file wovenclassfile length un woven class file unwovenclassfile length looking at lookingat shorter length shorterlength woven class file wovenclassfile looking at lookingat un woven class file unwovenclassfile looking at lookingat looking at lookingat length in common lengthincommon looking at lookingat diff un woven class file unwovenclassfile length length in common lengthincommon bytes diff constant pool count diff un woven class file unwovenclassfile diff un woven class file unwovenclassfile bytes length in common bytes lengthincommonbytes serialize int serializeint length in common lengthincommon diff length in common bytes lengthincommonbytes diff length in common bytes lengthincommonbytes diff length in common bytes lengthincommonbytes diff length in common bytes lengthincommonbytes dump un woven class file unwovenclassfile verbatim system arraycopy un woven class file unwovenclassfile length in common lengthincommon diff diff length diff apply diff applydiff woven class file wovenclassfile diff length in common lengthincommon read int readint diff un woven class file unwovenclassfile diff length length in common lengthincommon copy bytes woven class file wovenclassfile system arraycopy woven class file wovenclassfile un woven class file unwovenclassfile copy constant pool count diff un woven class file unwovenclassfile diff un woven class file unwovenclassfile diff copy woven class file wovenclassfile system arraycopy woven class file wovenclassfile un woven class file unwovenclassfile length in common lengthincommon copy stuff diff system arraycopy diff un woven class file unwovenclassfile length in common lengthincommon diff length un woven class file unwovenclassfile serialize int serializeint byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream data output stream dataoutputstream dos data output stream dataoutputstream bos dos write int writeint ioexception bos to byte array tobytearray write any reweavable data writeanyreweavabledata weaver state info weaverstateinfo wsi data output stream dataoutputstream ioexception wsi is reweavable isreweavable write list aspects exist time weave write short writeshort wsi aspects affecting type aspectsaffectingtype size wsi aspects affecting type aspectsaffectingtype size iterator iter wsi aspects affecting type aspectsaffectingtype iterator iter has next hasnext string type string iter write utf writeutf type data wsi unwoven class file unwovenclassfile insert diff wsi reweavable diff mode reweavablediffmode write int writeint data length write wsi unwoven class file unwovenclassfile