copyright xerox corporation rights reserved program accompanying materials terms common license accompanies distribution http eclipse org legal cpl html contributors xerox parc initial implementation org aspectj testing util java file java file filter filefilter java file input stream fileinputstream java file output stream fileoutputstream java ioexception java input stream inputstream java output stream outputstream java print writer printwriter java string buffer input stream stringbufferinputstream java string writer stringwriter java net malformed urlexception malformedurlexception java net url java util array list arraylist java util arrays java util collection java util enumeration java util iterator java util vector java util jar attributes java util jar jar output stream jaroutputstream java util jar manifest java util zip zip entry zipentry java util zip zip file zipfile java util zip zip output stream zipoutputstream misc file utilities file util fileutil filename url directory url html string url filename html param args string code copy src file srcfile src url srcurl src dest file destfile dest file destfile code main string args args args length copy equals args string arg args string src string dest file destfile src is file srcisfile src file srcfile equals arg src is file srcisfile src args src url srcurl equals arg src args src dest file destfile equals args dest file destfile args string buffer stringbuffer errs string buffer stringbuffer src is file srcisfile copy file copyfile file src file dest file destfile errs url url url url src malformed urlexception malformedurlexception render errs url copy url copyurl url file dest file destfile errs errs length system err println error copying src dest file destfile system err println errs to string tostring copy equals args main generate list missing extra files comparison timestamp optionally excluding files call select files time pre diffs dir diffs dirdiffs dir given time giventime pre files pre classes foo classes bar bash classes classes unexpected classes start gif pre predated start time starttime call reports unexpected unexpected foo missing pre string require suffix requiresuffix string expected paths expectedpaths string foo bar bas file file file classes diffs dir diffs dirdiffs dir start time starttime require suffix requiresuffix expected paths expectedpaths pre param label string diffs label param dir file dir search param start time starttime collect files modified time param require suffix requiresuffix ignore actual files suffix param expected paths expectedpaths paths relative dir expected files expected param accept file prefix acceptfileprefix accept file differs expected file suffix xxx complicated weak prefix checking diffs dir diffs dirdiffs string label file dir start time starttime string required suffix requiredsuffix string expected paths expectedpaths accept file prefix acceptfileprefix lang util langutil throw iax if null throwiaxifnull dir dir check expected checkexpected lang util langutil is empty isempty expected paths expectedpaths normalize sources ignore array list arraylist expected check expected checkexpected array list arraylist check expected checkexpected expected paths expectedpaths length string src path srcpath expected paths expectedpaths lang util langutil is empty isempty src path srcpath expected add org aspectj util file util fileutil weak normalize weaknormalize src path srcpath gather normalize paths changed file filter filefilter touched collector touchedcollector file filter filefilter files complying time suffix rules accumulate unexpected match expected files deleting matches sources remainder missing unexpected files accept file file file is file isfile start time starttime start time starttime file last modified lastmodified string path file get path getpath required suffix requiredsuffix path ends with endswith required suffix requiredsuffix path org aspectj util file util fileutil weak normalize weaknormalize path check expected checkexpected accept file prefix acceptfileprefix file equals lexical compare expected path expected remove path add unexpected iterator iter expected iterator iter has next hasnext string exp string iter path starts with startswith exp string suffix path substring exp length suffix index of indexof normalized expected remove path add unexpected add file time don suffix skip file time array list arraylist unexp array list arraylist unexp add all addall arrays as list aslist dir list files listfiles touched collector touchedcollector report unexpected diffs make diffs makediffs label expected unexp string insensitive order visit entries zip file halting visitor balks errors silently illegal argument exception illegalargumentexception zipfile visitor visit zip entries visitzipentries zip file zipfile zipfile string visitor stringvisitor visitor visit zip entries visitzipentries zipfile visitor string buffer stringbuffer visit entries zip file halting visitor balks errors reported errs illegal argument exception illegalargumentexception zipfile visitor visit zip entries visitzipentries zip file zipfile zipfile string visitor stringvisitor visitor string buffer stringbuffer errs zipfile illegal argument exception illegalargumentexception zipfile visitor illegal argument exception illegalargumentexception visitor enumeration enu zipfile entries enu has more elements hasmoreelements zip entry zipentry entry zip entry zipentry enu next element nextelement visitor accept entry get name getname throwable errs errs append file util fileutil visit zip entries visitzipentries error accessing entry get message getmessage string writer stringwriter string writer stringwriter print stack trace printstacktrace print writer printwriter errs append to string tostring zipfile zipfile close ignore ioexception descend filesystem tree invoking file filter filefilter accept files list files current directory code pre descend file tree descendfiletree file file filter filefilter accept file system println get absolute path getabsolutepath code pre param file root starting point file visited param filter supplies accept file routine descend file tree descendfiletree file file file filter filefilter filter descend file tree descendfiletree file filter descend filesystem tree invoking file filter filefilter accept files user recursion userrecursion dirs user recursion userrecursion accept call descend file tree descendfiletree recurse directories calls file filter filefilter accept file files dirs list files unix root code pre descend file tree descendfiletree file file filter filefilter file system println get absolute path getabsolutepath code pre list files dir root user recursion code pre descend file tree descendfiletree file file filter filefilter file system println get absolute path getabsolutepath is directory isdirectory get name getname index of indexof cvs descend file tree descendfiletree code pre param file root starting point file visited param filter supplies accept file method param user recursion userrecursion accept dirs recurse file filter filefilter accept file illegal argument exception illegalargumentexception file file filter filefilter descend file tree descendfiletree file file file filter filefilter file filter filefilter user recursion userrecursion file illegal argument exception illegalargumentexception parm file file filter filefilter illegal argument exception illegalargumentexception parm file filter filefilter file is directory isdirectory file filter filefilter accept file file can read canread files file files file list files listfiles valid file filter validfilefilter file exists files files length file filter filefilter accept files recurse handle directories file dirs file list files listfiles valid file filter validfilefilter dir exists dirs dirs length user recursion userrecursion file filter filefilter accept dirs descend file tree descendfiletree dirs file filter filefilter user recursion userrecursion readable directory ignore unreadable descend files descendfiles names files directory file directory files directory returned file absolute relative files file zip jar file entries zip jar listed entries jarfiles zipfiles listed guarantees ordering param dir file list param collection illegal argument exception illegalargumentexception dir collection string paths including paths jars collection directory to string directorytostring file dir collection dir illegal argument exception illegalargumentexception dir collection result vector is zip file iszipfile dir zip file to string zipfiletostring dir result dir is directory isdirectory illegal argument exception illegalargumentexception dir dir accumulating file filter accumulatingfilefilter ac filter acfilter accumulating file filter accumulatingfilefilter accumulate file file string file get path getpath result add is zip file iszipfile file zip file to string zipfiletostring file result descend file tree descendfiletree dir ac filter acfilter result directory to string directorytostring render string entries zip jar file converting string jarpath jarentry applying policies whitespace param file file enumerate zip entry zipentry param colection file line fileline file lines filelines string text canonical string modified canonicalizing policies collection zip file to string zipfiletostring file zipfile collection collection result vector zip file zipfile zip zip file zipfile open read zip file zipfile open delete delete zip zip file zipfile zipfile enumeration enu zip entries enu has more elements hasmoreelements add render zip entry renderzipentry zipfile zip entry zipentry enu next element nextelement zip close zip throwable string err error opening zipfile attempting system err println err print stack trace printstacktrace system err zip zip close ioexception print stack trace printstacktrace system err result file represents existing file zip extension is zip file iszipfile file string get path getpath can read canread is directory isdirectory ends with endswith zip ends with endswith jar render zip entry combination string string render zip entry renderzipentry file zipfile zip entry zipentry entry string filename zipfile file zipfile get name getname string entryname entry zip entry zipentry entry get name getname filename entryname write files directory jar file jarfile param jar file jarfile file create write param directory file representing directory read param main class mainclass main attribute create jar file createjarfile file jar file jarfile file directory string main class mainclass file filter filefilter filter string label create jar file createjarfile jar file jarfile directory main class mainclass filter log signal label start directory illegal argument exception illegalargumentexception directory manifest manifest create manifest createmanifest main class mainclass log signal label manifest manifest jar output stream jaroutputstream file jar file dir jarfiledir jar file jarfile get parent file getparentfile jar file dir jarfiledir log signal label jar file dir jarfiledir jar file dir jarfiledir exists jar file dir jarfiledir mkdirs xxx convert error log signal label unable create jar file dir jarfiledir jar file dir jarfiledir output stream outputstream file output stream fileoutputstream jar file jarfile manifest jar output stream jaroutputstream jar output stream jaroutputstream manifest log signal label zip accumulator zipaccumulator reader zip accumulator zipaccumulator directory filter log signal label reader reader file util fileutil descend file tree descendfiletree directory reader close entry closeentry ioexception print stack trace printstacktrace system err close todo ioexception manifest create manifest createmanifest string main class mainclass string main key mainkey main manifest result main class mainclass string entry manifest version main key mainkey main class mainclass result manifest string buffer input stream stringbufferinputstream entry attributes attributes result get main attributes getmainattributes string main attributes get value getvalue main key mainkey main attributes put value putvalue main key mainkey main class mainclass main attributes get value getvalue main key mainkey main log signal create manifest createmanifest unable main main class mainclass ioexception todo ignoring log signal ioexception creating manifest main class mainclass result read file zip stream add file to zip addfiletozip file file parent zip output stream zipoutputstream ioexception string path get canonical path getcanonicalpath string parent path parentpath parent get canonical path getcanonicalpath path starts with startswith parent path parentpath error parent parent path parentpath path path path substring parent path parentpath length path path replace zip entry zipentry entry zip entry zipentry path entry set time settime last modified lastmodified put next entry putnextentry entry input stream inputstream input input file input stream fileinputstream buf count count input read buf buf length write buf count input input close return temp dir returntempdir file dir delete directory deletedirectory dir is resource path isresourcepath string path path path path to lower case tolowercase path ends with endswith gif path ends with endswith properties path ends with endswith jpg path ends with endswith jpeg path ends with endswith props render throwable string buffer stringbuffer err string get class getclass get name getname loc last index of lastindexof substring loc err append get message getmessage string writer stringwriter string writer stringwriter print stack trace printstacktrace print writer printwriter err append to string tostring report string buffer stringbuffer err string context string status throwable throwable failed status throwable err failed context err append context status err append status throwable render throwable err failed copy file copyfile file src file dest string buffer stringbuffer err result string label start throwable throwable valid file filter validfilefilter file exists accept src label src file exist dest is directory isdirectory dest file dest src get name getname valid file filter validfilefilter file exists accept dest label dest file exists close when done closewhendone result copy file input stream fileinputstream src file output stream fileoutputstream dest close when done closewhendone label throwable throwable string context file util fileutil copy file copyfile src dest err report report err context label throwable result report copy url copyurl url url file dest string buffer stringbuffer err result string label start throwable throwable dest is directory isdirectory string filename url get file getfile filename filename length filename url filename dest file dest filename valid file filter validfilefilter file exists accept dest label dest file exists close when done closewhendone result copy url open connection openconnection get input stream getinputstream file output stream fileoutputstream dest close when done closewhendone label throwable throwable string context file util fileutil copy url copyurl src dest err report report err context label throwable result report copy input stream inputstream src output stream outputstream dest close ioexception result ioexception throwable buf count count src read buf buf length dest write buf count result ioexception throwable close src src close ioexception throwable throwable dest dest close ioexception throwable throwable throwable throwable result delete directory deletedirectory file dir dir dir exists dir is directory isdirectory file util fileutil descend file tree descendfiletree dir delete files file util fileutil descend file tree descendfiletree dir delete dirs dir delete string get paths getpaths file files string result string files length result length result files get path getpath result file filter filefilter delete dirs file filter filefilter accept file file file file is directory isdirectory file exists file delete file filter filefilter delete files file filter filefilter accept file file file file is directory isdirectory file exists file delete log signal string signal throwable string system err println print stack trace printstacktrace system err error string error zip accumulator zipaccumulator file filter filefilter file parent dir parentdir zip output stream zipoutputstream file filter filefilter filter zip accumulator zipaccumulator file parent dir parentdir zip output stream zipoutputstream file filter filefilter filter parent dir parentdir parent dir parentdir filter filter accept file filter filter accept file util fileutil add file to zip addfiletozip parent dir parentdir ioexception print stack trace printstacktrace system err