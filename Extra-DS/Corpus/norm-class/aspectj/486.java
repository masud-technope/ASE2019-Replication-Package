copyright ibm corporation rights reserved program accompanying materials terms common license accompanies distribution http eclipse org legal cpl html contributors adrian colyer org aspectj tools ajc java byte array output stream bytearrayoutputstream java file java ioexception java output stream outputstream java print stream printstream java lang reflect invocation target exception invocationtargetexception java lang reflect method java net url java net urlclass loader urlclassloader java util array list arraylist java util collections java util iterator java util list java util string tokenizer stringtokenizer junit framework test case testcase org aspectj bridge imessage org aspectj bridge isource location isourcelocation org aspectj testing util test util testutil org aspectj weaver loadtime weaving urlclass loader weavingurlclassloader test case testcase acts superclass test cases wishing drive ajc compiler number utility methods programmatic testing compiler easy ajc test case test ajctestcasetest couple simple tests written xmlbased ajc test case xmlbasedajctestcase subclass test case testcase drive compiler tests based ajc tests ajctests xml format test specification file org aspectj tools ajc ajc test case ajctestcase message org aspectj tools ajc ajc test case ajctestcase message spec messagespec org aspectj tools ajc ajc test case ajctestcase run result runresult org aspectj tools ajc ajc test case test ajctestcasetest org aspectj testing xmlbased ajc test case xmlbasedajctestcase ajc test case ajctestcase test case testcase run result runresult last run result lastrunresult ajc compiler instance thet test created afresh test setup ajc ajc string classpath entries file path separator pathseparator file separator runtime file separator bin file path separator pathseparator file separator testing client file separator bin file path separator pathseparator file separator bridge file separator bin file path separator pathseparator file separator util file separator bin file path separator pathseparator file separator aspectj file separator bin file path separator pathseparator file separator lib file separator junit file separator junit jar file path separator pathseparator file separator loadtime file separator bin file path separator pathseparator file separator weaver file separator bin file path separator pathseparator file separator weaver file separator bin bin directories types jars classpath file path separator pathseparator file separator build file separator jars file separator bridge jar file path separator pathseparator file separator build file separator jars file separator util jar file path separator pathseparator file separator build file separator jars file separator loadtime jar file path separator pathseparator file separator build file separator jars file separator weaver jar file path separator pathseparator file separator build file separator jars file separator weaver jar file path separator pathseparator file separator build file separator jars file separator asm jar file path separator pathseparator file separator lib file separator test file separator testing client jar hmmm point build jar file path separator pathseparator file separator lib file separator test file separator aspectjrt jar save reference real stderr stdout starting redirection print stream printstream err system err print stream printstream system delegating output stream delegatingoutputstream delegating err delegatingerr delegating output stream delegatingoutputstream delegating out delegatingout get boolean getboolean org aspectj tools ajc ajc test case ajctestcase verbose verbose err verbose get boolean getboolean org aspectj tools ajc ajc test case ajctestcase verbose err verbose verbose get boolean getboolean org aspectj tools ajc ajc test case ajctestcase verbose verbose helper represents specification individual message expected produced compilation message objects combined message spec messagespec passed assert message assertmessage methods org aspectj tools ajc ajc test case ajctestcase message spec messagespec message string text string source file name sourcefilename isource location isourcelocation see alsos seealsos create message match compiler message message create message match compiler message message text code text code message string text text text create message match compiler message message text code text code src file srcfile source file location message code src file srcfile code code see also seealso code source location see also seealso matched extra source location extrasourcelocation message message string src file srcfile string text isource location isourcelocation see also seealso string buffer stringbuffer src file name srcfilename string buffer stringbuffer src file srcfile chars src file srcfile to char array tochararray chars length chars chars src file name srcfilename append file separator src file name srcfilename append chars source file name sourcefilename src file name srcfilename to string tostring text text see alsos seealsos see also seealso message string text text text matches imessage message isource location isourcelocation loc message get source location getsourcelocation loc source file name sourcefilename loc get line getline source file name sourcefilename loc get source file getsourcefile get path getpath ends with endswith source file name sourcefilename text message get message getmessage index of indexof text see alsos seealsos list extra locations extralocations message get extra source locations getextrasourcelocations extra locations extralocations size see alsos seealsos length see alsos seealsos length has amatch hasamatch extra locations extralocations see alsos seealsos has amatch hasamatch list src locations srclocations isource location isourcelocation s loc sloc iterator iter src locations srclocations iterator iter has next hasnext isource location isourcelocation this loc thisloc isource location isourcelocation iter this loc thisloc get line getline s loc sloc get line getline this loc thisloc get source file getsourcefile get path getpath equals s loc sloc get source file getsourcefile get path getpath string to string tostring string buffer stringbuffer buff string buffer stringbuffer buff append message source file name sourcefilename buff append file buff append source file name sourcefilename buff append buff append buff append buff append text buff append text buff append text buff append see alsos seealsos buff append twith alsos see alsos seealsos length buff append buff append see alsos seealsos get source file getsourcefile get path getpath buff append buff append see alsos seealsos get line getline buff to string tostring message spec messagespec message spec messagespec empty message message spec messagespec collections empty list collections empty list collections empty list collections empty list ignore infos ignoreinfos list fails list infos list warnings list errors list weaves set info comparison setinfocomparison enabled ignore infos ignoreinfos enabled is ignoring info messages isignoringinfomessages ignore infos ignoreinfos message spec messagespec list infos list warnings list errors list fails list weaves infos infos infos ignore infos ignoreinfos infos collections empty list warnings warnings collections empty list warnings errors errors collections empty list errors fails fails collections empty list fails weaves weaves collections empty list weaves message spec messagespec list infos list warnings list errors infos warnings errors message spec messagespec list warnings list errors warnings errors empty message spec emptymessagespec message spec messagespec empty message spec emptymessagespec run result runresult string command string std out stdout string std err stderr run result runresult string command string std out stdout string std err stderr command command std out stdout std out stdout std err stderr std err stderr string get command getcommand command string get std out getstdout std out stdout string get std err getstderr std err stderr string to string tostring command assert no messages assertnomessages compilation result compilationresult result assert no messages assertnomessages result expecting compiler messages produced assert no messages assertnomessages compilation result compilationresult result string message assert messages assertmessages result message message spec messagespec empty message assert messages assertmessages compilation result compilationresult result message spec messagespec expected assert messages assertmessages result compilation meet expected messages specification expected assert messages assertmessages compilation result compilationresult result string message message spec messagespec expected result fail attempt compare compilation expected list missing fails missingfails copy all copyall expected fails list missing infos missinginfos copy all copyall expected infos list missing warnings missingwarnings copy all copyall expected warnings list missing errors missingerrors copy all copyall expected errors list missing weaves missingweaves copy all copyall expected weaves list extra fails extrafails copy all copyall result get fail messages getfailmessages list extra infos extrainfos copy all copyall result get info messages getinfomessages list extra warnings extrawarnings copy all copyall result get warning messages getwarningmessages list extra errors extraerrors copy all copyall result get error messages geterrormessages list extra weaves extraweaves copy all copyall result get weave messages getweavemessages compare expected fails result get fail messages getfailmessages missing fails missingfails extra fails extrafails compare expected warnings result get warning messages getwarningmessages missing warnings missingwarnings extra warnings extrawarnings compare expected errors result get error messages geterrormessages missing errors missingerrors extra errors extraerrors expected is ignoring info messages isignoringinfomessages compare expected infos result get info messages getinfomessages missing infos missinginfos extra infos extrainfos compare expected weaves result get weave messages getweavemessages missing weaves missingweaves extra weaves extraweaves infos empty infosempty expected is ignoring info messages isignoringinfomessages missing infos missinginfos is empty isempty extra infos extrainfos is empty isempty missing fails missingfails is empty isempty missing warnings missingwarnings is empty isempty missing errors missingerrors is empty isempty missing weaves missingweaves is empty isempty extra fails extrafails is empty isempty extra warnings extrawarnings is empty isempty extra errors extraerrors is empty isempty extra weaves extraweaves is empty isempty infos empty infosempty string buffer stringbuffer failure report failurereport string buffer stringbuffer message failure report failurereport append expected is ignoring info messages isignoringinfomessages add missing addmissing failure report failurereport info missing infos missinginfos add missing addmissing failure report failurereport warning missing warnings missingwarnings add missing addmissing failure report failurereport error missing errors missingerrors add missing addmissing failure report failurereport fail missing fails missingfails add missing addmissing failure report failurereport weave info weaveinfo missing weaves missingweaves expected is ignoring info messages isignoringinfomessages add extra addextra failure report failurereport info extra infos extrainfos add extra addextra failure report failurereport warning extra warnings extrawarnings add extra addextra failure report failurereport error extra errors extraerrors add extra addextra failure report failurereport fail extra fails extrafails add extra addextra failure report failurereport weave info weaveinfo extra weaves extraweaves failure report failurereport append ncommand ajc string args result get args getargs args length failure report failurereport append failure report failurereport append args string report failure report failurereport to string tostring system err println failure report failurereport fail message report list new message list newmessagelist message list ret array list arraylist ret add ret list new message list newmessagelist message message list ret array list arraylist ret add ret add ret list new message list newmessagelist message message message list ret array list arraylist ret add ret add ret add ret list new message list newmessagelist message messages list ret array list arraylist messages length ret add messages ret compilation result compilationresult ajc file base dir basedir string args ajc set base dir setbasedir base dir basedir args fixup args fixupargs args ajc compile args ioexception io ex ioex fail ioexception thrown compilation io ex ioex file get sandbox directory getsandboxdirectory ajc get sandbox directory getsandboxdirectory set should empty sandbox setshouldemptysandbox empty ajc set should empty sandbox setshouldemptysandbox empty run result runresult get last run result getlastrunresult last run result lastrunresult test nothing for ant junit testnothingforantjunit run result runresult string class name classname class name classname string run result runresult string class name classname string args string classpath class name classname args run result runresult string class name classname string args string classpath use ltw useltw last run result lastrunresult string buffer stringbuffer string buffer stringbuffer classpath append classpath append file path separator pathseparator append ajc get sandbox directory getsandboxdirectory get absolute path getabsolutepath append classpath entries get any jars getanyjars ajc get sandbox directory getsandboxdirectory classpath to string tostring string buffer stringbuffer command string buffer stringbuffer java classpath command append classpath command append command append class name classname args length command append command append args byte array output stream bytearrayoutputstream baos out baosout byte array output stream bytearrayoutputstream byte array output stream bytearrayoutputstream baos err baoserr byte array output stream bytearrayoutputstream string tokenizer stringtokenizer str tok strtok string tokenizer stringtokenizer classpath file path separator pathseparator url urls url str tok strtok count tokens counttokens urls length urls file str tok strtok next token nexttoken get canonical file getcanonicalfile to url tourl exception mal ex malex fail bad classpath specification classpath urlclass loader urlclassloader c loader cloader use ltw useltw class loader classloader parent get class getclass get class loader getclassloader c loader cloader weaving urlclass loader weavingurlclassloader urls parent c loader cloader urlclass loader urlclassloader urls tester class testerclass c loader cloader load class loadclass org aspectj testing tester method set base dir setbasedir tester class testerclass get declared method getdeclaredmethod set basedir setbasedir file set base dir setbasedir invoke object ajc get sandbox directory getsandboxdirectory exception fail unable prepare org aspectj testing tester test start capture startcapture baos err baoserr baos out baosout to run torun c loader cloader load class loadclass class name classname method main method mainmethod to run torun get method getmethod main string main method mainmethod invoke object args last run result lastrunresult run result runresult command to string tostring string baos out baosout to byte array tobytearray string baos err baoserr to byte array tobytearray class not found exception classnotfoundexception cnf fail find class name classname no such method exception nosuchmethodexception nsm fail class name classname main method illegal access exception illegalaccessexception ill ex illex fail main method class name classname invocation target exception invocationtargetexception inv tgt invtgt fail exception thrown class name classname main string inv tgt invtgt get target exception gettargetexception stop capture stopcapture baos err baoserr baos out baosout last run result lastrunresult string fixup args fixupargs string args args cp index cpindex hasruntime args length args adapt to platform adapttoplatform args classpath equals args cp index cpindex string args hasruntime index of indexof aspectjrt jar cp index cpindex string newargs string args length newargs classpath newargs test util testutil aspectjrt path aspectjrtpath get path getpath system arraycopy args newargs args length args newargs hasruntime cp index cpindex string newargs string args length system arraycopy args newargs args length newargs cp index cpindex args cp index cpindex file path separator pathseparator test util testutil aspectjrt path aspectjrtpath get path getpath args newargs args string adapt to platform adapttoplatform string string ret replace file path separator char pathseparatorchar ret list copy all copyall list collections empty list list array list arraylist iterator iter iterator iter has next hasnext add iter compare list expected list actual list missing elements missingelements list extra elements extraelements iterator expected iter expectediter expected iterator expected iter expectediter has next hasnext message expected message expectedmessage message expected iter expectediter iterator actual iter actualiter actual iterator actual iter actualiter has next hasnext imessage actual message actualmessage imessage actual iter actualiter expected message expectedmessage matches actual message actualmessage missing elements missingelements remove expected message expectedmessage extra elements extraelements remove actual message actualmessage add missing addmissing string buffer stringbuffer buff string type list messages messages is empty isempty buff append missing expected buff append type buff append messages iterator iter messages iterator iter has next hasnext buff append buff append iter to string tostring buff append add extra addextra string buffer stringbuffer buff string type list messages messages is empty isempty buff append unexpected buff append type buff append messages iterator iter messages iterator iter has next hasnext buff append buff append iter to string tostring buff append get any jars getanyjars file dir string buffer stringbuffer buff file files dir list files listfiles files length files get name getname ends with endswith jar buff append file path separator pathseparator buff append files get absolute path getabsolutepath files is directory isdirectory get any jars getanyjars files buff start capture startcapture output stream outputstream err os erros output stream outputstream out os outos delegating err delegatingerr add err os erros delegating out delegatingout add out os outos delegating err delegatingerr set verbose setverbose err verbose delegating out delegatingout set verbose setverbose verbose stop capture stopcapture output stream outputstream err os erros output stream outputstream out os outos delegating err delegatingerr set verbose setverbose delegating out delegatingout set verbose setverbose delegating err delegatingerr remove err os erros delegating out delegatingout remove out os outos get boolean getboolean string def string default value defaultvalue string value of valueof def string system get property getproperty default value defaultvalue value of valueof boolean value booleanvalue set up setup exception set up setup ajc ajc tear down teardown exception tear down teardown delegating err delegatingerr delegating output stream delegatingoutputstream err system set err seterr print stream printstream delegating err delegatingerr delegating out delegatingout delegating output stream delegatingoutputstream system set out setout print stream printstream delegating out delegatingout