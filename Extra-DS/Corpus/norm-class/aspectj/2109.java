nwalsh saxon java util stack java util string tokenizer stringtokenizer org xml sax org dom javax xml transform transformer exception transformerexception icl saxon name pool namepool icl saxon output emitter icl saxon tree attribute collection attributecollection saxon extension decorate result tree fragment callouts callout emitter calloutemitter java isberg exp copyright norman walsh guts href http users iclway mhkay saxon saxon implementation callouts verbatim environments verbatim general design stylesheets construct result tree fragment verbatim environment verbatim initializes callout emitter calloutemitter callouts applied verbatim environment question result tree fragment replayed callout emitter calloutemitter callout emitter calloutemitter builds result tree fragment event stream decorated callouts returned change log initial release verbatim author norman walsh href mailto ndw nwalsh ndw nwalsh version callout emitter calloutemitter java isberg exp callout emitter calloutemitter copy emitter copyemitter stack preserving open elements stack element stack elementstack stack holding temporarily closed elements stack temp stack tempstack element absolutely element fragment first element firstelement namespace string fo uri fouri http org xsl format column callouts default column defaultcolumn stylesheet running stylesheet fo stylesheet fostylesheet current number line number linenumber current column number col number colnumber sorted array callouts areaspec callout callout number callouts callout array callout count calloutcount pointer track position callout array callout pos calloutpos format callout formatcallout object formatting callouts format callout formatcallout f callout fcallout constructor callout emitter calloutemitter param name pool namepool pool constructing elements attributes param graphics path graphicspath path callout number graphics param graphics ext graphicsext extension callout number graphics param graphics max graphicsmax largest callout number represented graphic param default column defaultcolumn column callouts param fo stylesheet fostylesheet stylesheet callout emitter calloutemitter name pool namepool name pool namepool default column defaultcolumn fo stylesheet fostylesheet format callout formatcallout f callout fcallout name pool namepool element stack elementstack stack first element firstelement default column defaultcolumn default column defaultcolumn fo stylesheet fostylesheet fo stylesheet fostylesheet f callout fcallout f callout fcallout examine areaspec determine number position callouts code href http docbook org tdg html areaspec html areaspec node set areaspecnodeset code examined sorted list callouts constructed data structure augment result tree fragment callout bullets param areaspec node set areaspecnodeset source document areaspec element setup callouts setupcallouts node list nodelist areaspec node list areaspecnodelist callout callout callout count calloutcount callout pos calloutpos line number linenumber col number colnumber walk areaspec calculate position callouts areaspec areaset plco coords area plco coords area plco coords areaset area plco ret coords area plco dest coords areaspec pos co num conum in area set inareaset node areaspec areaspec node list areaspecnodelist item node list nodelist children areaspec get child nodes getchildnodes count count children get length getlength count node node children item count node get node type getnodetype node element node node get node name getnodename equals ignore case equalsignorecase areaset co num conum node list nodelist areas node get child nodes getchildnodes acount acount areas get length getlength acount node area areas item acount area get node type getnodetype node element node area get node name getnodename equals ignore case equalsignorecase area add callout addcallout co num conum area default column defaultcolumn system println unexpected element areaset area get node name getnodename node get node name getnodename equals ignore case equalsignorecase area co num conum add callout addcallout co num conum node default column defaultcolumn system println unexpected element areaspec node get node name getnodename sort java util arrays sort callout callout count calloutcount process characters characters chars start len transformer exception transformerexception hit characters element first element firstelement line number linenumber text nodes line number linenumber col number colnumber walk text node callout positions new chars newchars len pos count start count start len count callout pos calloutpos callout count calloutcount callout callout pos calloutpos get line getline line number linenumber callout callout pos calloutpos get column getcolumn col number colnumber pos rtf emitter rtfemitter characters new chars newchars pos pos close open elements closeopenelements rtf emitter rtfemitter callout pos calloutpos callout count calloutcount callout callout pos calloutpos get line getline line number linenumber callout callout pos calloutpos get column getcolumn col number colnumber f callout fcallout format callout formatcallout rtf emitter rtfemitter callout callout pos calloutpos callout pos calloutpos open closed elements openclosedelements rtf emitter rtfemitter chars count pad callout pos calloutpos callout count calloutcount callout callout pos calloutpos get line getline line number linenumber callout callout pos calloutpos get column getcolumn col number colnumber pos rtf emitter rtfemitter characters new chars newchars pos pos close open elements closeopenelements rtf emitter rtfemitter callout pos calloutpos callout count calloutcount callout callout pos calloutpos get line getline line number linenumber callout callout pos calloutpos get column getcolumn col number colnumber format pad formatpad callout callout pos calloutpos get column getcolumn col number colnumber col number colnumber callout callout pos calloutpos get column getcolumn callout pos calloutpos callout count calloutcount callout callout pos calloutpos get line getline line number linenumber callout callout pos calloutpos get column getcolumn col number colnumber f callout fcallout format callout formatcallout rtf emitter rtfemitter callout callout pos calloutpos callout pos calloutpos open closed elements openclosedelements rtf emitter rtfemitter line number linenumber col number colnumber col number colnumber new chars newchars pos chars count pos rtf emitter rtfemitter characters new chars newchars pos add blanks result tree fragment method adds num blanks numblanks result tree fragment pad lines callouts occur existing characater param num blanks numblanks number blanks add format pad formatpad num blanks numblanks chars num blanks numblanks count count num blanks numblanks count chars count rtf emitter rtfemitter characters chars num blanks numblanks transformer exception transformerexception system println transformer exception format pad formatpad add callout global callout array method examines callout area adds global callout array interpreted linecolumn linerange units supported unit specifed linecolumn assumed callout decoration appears default column defaultcolumn param co num conum callout number param node area param default column defaultcolumn column callouts add callout addcallout co num conum node node default column defaultcolumn element area element node string units string coords area has attribute hasattribute units units area get attribute getattribute units area has attribute hasattribute coords coords area get attribute getattribute coords units units equals ignore case equalsignorecase linecolumn units equals ignore case equalsignorecase linerange system println linecolumn linerange units supported coords system println coords interpret coordinates string tokenizer stringtokenizer string tokenizer stringtokenizer coords token count tokencount has more tokens hasmoretokens token count tokencount token count tokencount system println unparseable coordinates string token next token nexttoken coord integer parse int parseint token coord token count tokencount coord number format exception numberformatexception system println unparseable coordinate blow array callout count calloutcount callout length callout bigger callout callout count calloutcount count count callout length count bigger count callout count callout bigger add callout token count tokencount units units equals ignore case equalsignorecase linerange count count count callout callout count calloutcount callout co num conum area count default column defaultcolumn assume linecolumn callout callout count calloutcount callout co num conum area number assume callout callout count calloutcount callout co num conum area default column defaultcolumn process element events end element endelement name code namecode transformer exception transformerexception element stack elementstack empty didn push element block pre div surrounding block stack empty element element stack elementstack pop rtf emitter rtfemitter end element endelement name code namecode process start element events start element startelement name code namecode org xml sax attributes attributes namespaces nscount transformer exception transformerexception skip this element skipthiselement name code namecode start element info startelementinfo sei start element info startelementinfo name code namecode attributes namespaces nscount element stack elementstack push sei first element firstelement rtf emitter rtfemitter start element startelement name code namecode attributes namespaces nscount protect block wrapper open elements result tree fragment closed reopened callouts callouts don links environments result tree fragment single block div pre html block block treated specially method returns element question outermost block param name code namecode code element element block skip this element skipthiselement name code namecode first element firstelement this fingerprint thisfingerprint name pool namepool get fingerprint getfingerprint name code namecode fo block fingerprint foblockfingerprint name pool namepool get fingerprint getfingerprint fo uri fouri block html pre fingerprint htmlprefingerprint name pool namepool get fingerprint getfingerprint pre html div fingerprint htmldivfingerprint name pool namepool get fingerprint getfingerprint div fo stylesheet fostylesheet this fingerprint thisfingerprint fo block fingerprint foblockfingerprint fo stylesheet fostylesheet this fingerprint thisfingerprint html pre fingerprint htmlprefingerprint this fingerprint thisfingerprint html div fingerprint htmldivfingerprint don push wrapping div pre block close open elements closeopenelements emitter rtf emitter rtfemitter transformer exception transformerexception close open elements temp stack tempstack stack element stack elementstack empty start element info startelementinfo elem start element info startelementinfo element stack elementstack pop rtf emitter rtfemitter end element endelement elem get name code getnamecode temp stack tempstack push elem open closed elements openclosedelements emitter rtf emitter rtfemitter transformer exception transformerexception reopen elements closed temp stack tempstack empty start element info startelementinfo elem start element info startelementinfo temp stack tempstack pop attribute collection attributecollection attr attribute collection attributecollection elem get attributes getattributes attribute collection attributecollection new attr newattr attribute collection attributecollection name pool namepool acount acount attr get length getlength acount string local name localname attr get local name getlocalname acount name code namecode attr get name code getnamecode acount string type attr get type gettype acount string attr get value getvalue acount string uri attr get uri geturi acount string prefix local name localname index of indexof prefix local name localname substring local name localname index of indexof local name localname local name localname substring local name localname index of indexof uri equals fo stylesheet fostylesheet local name localname equals fo stylesheet fostylesheet local name localname equals local name localname equals skip attribute new attr newattr add attribute addattribute prefix uri local name localname type rtf emitter rtfemitter start element startelement elem get name code getnamecode new attr newattr elem get namespaces getnamespaces elem get nscount getnscount element stack elementstack push elem maintaining required call start element startelement method order close reopen elements elements maintained record push stack track info start element info startelementinfo name code namecode org xml sax attributes attributes namespaces nscount start element info startelementinfo name code namecode org xml sax attributes attributes namespaces nscount name code namecode name code namecode attributes attributes namespaces namespaces nscount nscount get name code getnamecode name code namecode org xml sax attributes get attributes getattributes attributes get namespaces getnamespaces namespaces get nscount getnscount nscount