copyright ibm rights reserved program accompanying materials terms common license accompanies distribution http eclipse org legal cpl html contributors andy clement initial implementation org aspectj apache bcel classfile tests java file java ioexception java util iterator org aspectj apache bcel classfile field org aspectj apache bcel classfile java class javaclass org aspectj apache bcel classfile annotation annotation org aspectj apache bcel classfile annotation element name value pair elementnamevaluepair org aspectj apache bcel class gen classgen org aspectj apache bcel field gen fieldgen org aspectj apache bcel annotation annotation gen annotationgen org aspectj apache bcel util synthetic repository syntheticrepository field annotations test fieldannotationstest bcel test case bceltestcase set up setup exception set up setup check field annotations retrievable test field annotations testfieldannotations class not found exception classnotfoundexception java class javaclass clazz get class from jar getclassfromjar annotated fields annotatedfields check annotated field checkannotatedfield clazz simple annotation simpleannotation check annotated field checkannotatedfield clazz simple annotation simpleannotation check field annotations serialize test field annotations read write testfieldannotationsreadwrite class not found exception classnotfoundexception ioexception java class javaclass clazz get class from jar getclassfromjar annotated fields annotatedfields check annotated field checkannotatedfield clazz simple annotation simpleannotation check annotated field checkannotatedfield clazz simple annotation simpleannotation write file tfile create testdata file createtestdatafile annotated fields annotatedfields clazz dump tfile synthetic repository syntheticrepository repos create repos createrepos java class javaclass clazz repos load class loadclass annotated fields annotatedfields check annotated field checkannotatedfield clazz simple annotation simpleannotation check annotated field checkannotatedfield clazz simple annotation simpleannotation assert true asserttrue tfile delete check load modify field annotations save reload correct test field annotations modification testfieldannotationsmodification class not found exception classnotfoundexception ioexception dbg java class javaclass clazz get class from jar getclassfromjar annotated fields annotatedfields class gen classgen clg class gen classgen clazz field clg get fields getfields dbg system err println field freshly constructed dbg system err println annotations field dump annotations dumpannotations get annotations getannotations annotation gen annotationgen fruit based annotation fruitbasedannotation create fruit annotation createfruitannotation clg get constant pool getconstantpool tomato field gen fieldgen field gen fieldgen clg get constant pool getconstantpool dbg system err println adding annotation field add annotation addannotation fruit based annotation fruitbasedannotation dbg system err println field gen fieldgen mutable field dbg system err println annotations dump annotations dumpannotations get annotations getannotations dbg system err println replacing original field field extra annotation clg remove field removefield clg add field addfield get field getfield fields removing readding changed order clg get fields getfields time field dbg system err println field dbg system err println annotations dump annotations dumpannotations get annotations getannotations assert true asserttrue annotations field get annotations getannotations length get annotations getannotations length helper methods check annotated field checkannotatedfield java class javaclass clazz string fieldname string annotation name annotationname string annotation element name annotationelementname string annotation element value annotationelementvalue field fields clazz get fields getfields fields length field fields annotation field annotations fieldannotations get annotations getannotations get name getname equals fieldname check annotation checkannotation field annotations fieldannotations annotation name annotationname annotation element name annotationelementname annotation element value annotationelementvalue check annotation checkannotation annotation string string elementname string elementvalue assert true asserttrue expected annotation get type name gettypename get type name gettypename equals assert true asserttrue expected annotation element get values getvalues size get values getvalues size element name value pair elementnamevaluepair envp element name value pair elementnamevaluepair get values getvalues assert true asserttrue expected element elementname envp get name string getnamestring elementname equals envp get name string getnamestring assert true asserttrue expected element elementvalue envp get value getvalue stringify value stringifyvalue elementvalue equals envp get value getvalue stringify value stringifyvalue helper methods check value checkvalue annotation string string tostring iterator get values getvalues iterator has next hasnext element name value pair elementnamevaluepair element element name value pair elementnamevaluepair element get name string getnamestring equals element get value getvalue stringify value stringifyvalue equals tostring fail expected element tostring element get value getvalue stringify value stringifyvalue fail didnt find named element tear down teardown exception tear down teardown