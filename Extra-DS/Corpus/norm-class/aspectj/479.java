copyright palo alto center incorporated parc rights reserved program accompanying materials terms common license accompanies distribution http eclipse org legal cpl html contributors xerox parc initial implementation org aspectj internal tools ant taskdefs java file java file writer filewriter java ioexception java lang reflect method java net url java net urlclass loader urlclassloader java util array list arraylist java util arrays java util collection java util hash map hashmap java util hashtable java util iterator java util list java util map org apache tools ant build exception buildexception org apache tools ant project org apache tools ant target org apache tools ant task org apache tools ant taskdefs copy org apache tools ant taskdefs javac org apache tools ant taskdefs zip org apache tools ant types file set fileset org apache tools ant types path org apache tools ant types zip file set zipfileset org aspectj internal tools build build spec buildspec org aspectj internal tools build builder org aspectj internal tools build messager org aspectj internal tools build module org aspectj internal tools build result org aspectj internal tools build util org aspectj internal tools build result kind implement builder ant ant builder antbuilder builder force fork libraries factory builder param config string configuration substrings verbose use eclipse compiles useeclipsecompiles param project owning project tasks param temp dir tempdir file path temporary dir side effects builder project configuration builder get builder getbuilder string config project project file temp dir tempdir use eclipse compiles useeclipsecompiles verbose config config index of indexof use eclipse compiles useeclipsecompiles use eclipse compiles useeclipsecompiles config index of indexof verbose verbose messager handler messager debugging messager handler project messager projectmessager project builder result product builder productbuilder project temp dir tempdir use eclipse compiles useeclipsecompiles handler verbose result set verbose setverbose result string result to target name resulttotargetname result result result get name getname ensure targets exist module antecedants topo sort toposort work make targets for result maketargetsforresult result result hashtable targets string result target name resulttargetname result to target name resulttotargetname result target target target targets result target name resulttargetname target add target target target target set name setname result target name resulttargetname result reqs result get required getrequired string buffer stringbuffer depends string buffer stringbuffer reqs length result req result reqresult reqs depends append depends append result to target name resulttotargetname req result reqresult depends length target set depends setdepends depends to string tostring targets result target name resulttargetname target recursively add required reqs length result req result reqresult reqs make targets for result maketargetsforresult req result reqresult targets project project ant builder antbuilder project project file temp dir tempdir use eclipse compiles useeclipsecompiles messager handler temp dir tempdir use eclipse compiles useeclipsecompiles handler project project util iax if null iaxifnull project project initialize task project ajbuild prefix distinguishes tasks tasks build script param task task initialize param string suffix task error setup task setuptask task task string task set project setproject project task set task name settaskname ajbuild copy file optionally filtering filters project param from file fromfile readable file source copy param to file tofile writable file destination file param filter enable filtering org aspectj internal tools build builder copy file copyfile file file copy file copyfile file from file fromfile file to file tofile filter copy copy make copy task makecopytask filter copy set file setfile from file fromfile copy set tofile settofile to file tofile execute task executetask copy filters project org aspectj internal tools ant taskdefs builder copy files copyfiles file file string string copy files copyfiles file from dir fromdir file to dir todir string includes string excludes filter copy copy make copy task makecopytask filter copy set todir settodir to dir todir file set fileset fileset file set fileset fileset set dir setdir from dir fromdir includes fileset set includes setincludes includes excludes fileset set excludes setexcludes excludes copy add fileset addfileset fileset execute task executetask copy copy fileset copyfileset file to dir todir file set fileset file set fileset filter copy copy make copy task makecopytask filter copy add fileset addfileset file set fileset copy set todir settodir to dir todir execute task executetask copy param filter filter filters copy make copy task makecopytask filter copy copy copy setup task setuptask copy copy filter filter copy set filtering setfiltering copy dump min file dumpminfile result result file classes dir classesdir list errors string result get name getname empty file min file minfile file classes dir classesdir file writer filewriter file writer filewriter min file minfile write ioexception errors add ioexception writing min file minfile util render exception renderexception util close compile result result file classes dir classesdir use existing classes useexistingclasses list errors classes dir classesdir exists classes dir classesdir mkdirs errors add compile unable create classes dir classesdir use existing classes useexistingclasses source paths path path path project has source directories hassourcedirectories is java isjava compile iterator iter result get src dirs getsrcdirs iterator iter has next hasnext file file file iter path create path element createpathelement set location setlocation file is java isjava compile util constants java src equals file get name getname util constants java testsrc equals file get name getname is java isjava compile has source directories hassourcedirectories has source directories hassourcedirectories has source directories hassourcedirectories compile xxx test build compiler property takes automatically suspect requires proper adapter setup javac javac javac setup task setuptask javac javac javac set includeantruntime setincludeantruntime javac set destdir setdestdir classes dir classesdir javac set srcdir setsrcdir path javac set verbose setverbose verbose path classpath path classpath path project has libraries haslibraries setup classpath setupclasspath result classpath has libraries haslibraries force fork libraries releases library jars javac set fork setfork build fork javac compile fork output directory classpath create path element createpathelement set location setlocation classes dir classesdir javac set classpath setclasspath classpath misc javac set debug setdebug is java isjava compile files javac javac set target settarget javac set source setsource javac set source setsource javac set target settarget compile passed build exception buildexception failure passed execute task executetask aspect jsupport aspectjsupport wrap if needed wrapifneeded result javac build exception buildexception failure error failure build exception buildexception runtime exception runtimeexception failure build exception buildexception passed string args arrays as list aslist javac get current compiler args getcurrentcompilerargs equals args args result to long string tolongstring string build exception buildexception compiling result to long string tolongstring args failure util render exception renderexception failure debuglog system err println errors add nice classpath libraries javac init passed setup classpath setupclasspath result result path classpath xxx test access has libraries haslibraries required libraries iterator iter result get lib jars getlibjars iterator iter has next hasnext file file file iter classpath create path element createpathelement set location setlocation file has libraries haslibraries has libraries haslibraries kind kind result get kind getkind result reqs result get required getrequired required modules exported libraries reqs length result required result requiredresult reqs classpath create path element createpathelement set location setlocation required result requiredresult get output file getoutputfile has libraries haslibraries has libraries haslibraries xxx exported modules supported iterator iterator required result requiredresult get exported lib jars getexportedlibjars iterator iterator has next hasnext classpath create path element createpathelement set location setlocation file iterator has libraries haslibraries merge classes directory merge jars module jar manifest file meta inf directories excluded assemble result result file classes dir classesdir list errors building enabled buildingenabled result out of date outofdate zip result zip zip zip setup task setuptask zip zip zip set dest file setdestfile result get output file getoutputfile zip file set zipfileset zipfileset merge resources src directories iterator iter result get src dirs getsrcdirs iterator iter has next hasnext file src dir srcdir file iter zipfileset zip file set zipfileset zipfileset set project setproject project zipfileset set dir setdir src dir srcdir zipfileset set includes setincludes resource pattern zip add zipfileset addzipfileset zipfileset module module result get module getmodule file meta inf dir metainfdir file classes dir classesdir meta inf util delete contents deletecontents meta inf dir metainfdir manifest xxxfile literal xxxfileliteral file manifest file module module dir moduledir module txt util can read file canreadfile manifest util can read dir canreaddir meta inf dir metainfdir meta inf dir metainfdir mkdirs jar spec requires manifest manifest xxxfile literal xxxfileliteral copy file copyfile manifest file meta inf dir metainfdir manifest filter errors add manifest unable create meta inf dir metainfdir zipfileset zip file set zipfileset zipfileset set project setproject project zipfileset set dir setdir classes dir classesdir zipfileset set includes setincludes zip add zipfileset addzipfileset zipfileset file contents classes dir classesdir list files listfiles contents contents length zip dump min file dumpminfile result classes dir classesdir errors handler log assemble module result get output file getoutputfile execute task executetask zip entries add verify util can read file canreadfile result get output file getoutputfile build exception buildexception errors add build exception buildexception zipping module get message getmessage result clear out of date clearoutofdate org aspectj internal tools build builder build antecedants buildantecedants module result get antecedant results getantecedantresults result module result moduleresult hashtable targets hashtable make targets for result maketargetsforresult module result moduleresult targets string target name targetname result to target name resulttotargetname module result moduleresult bug doc topo sort toposort returns string returns target collection result project topo sort toposort target name targetname targets fyi don rely topo sort toposort detect cycles build all buildall size result size result size result array list arraylist to return toreturn array list arraylist iterator iter result iterator iter has next hasnext target target target iter string target get name getname error to return toreturn add topo sort toposort returns target size target name targetname equals to return toreturn module result moduleresult out of date outofdate result result get results getresults string to return toreturn to array toarray string generate module assembled jar assembledjar merge antecedants assemble all assembleall result result messager handler building enabled buildingenabled result out of date outofdate util iax if null iaxifnull result result util iax if null iaxifnull handler handler result get kind getkind is assembly isassembly illegal state exception illegalstateexception assembly result zip result zip zip zip setup task setuptask zip zip zip set dest file setdestfile result get output file getoutputfile zip file set zipfileset zipfileset module module result get module getmodule list result find jar requirements findjarrequirements remove library files to skip removelibraryfilestoskip module merge antecedents manifest iterator iter iterator iter has next hasnext file jar file jarfile file iter zipfileset zip file set zipfileset zipfileset set project setproject project zipfileset set src setsrc jar file jarfile zipfileset set includes setincludes string jar file jarfile get name getname jar length substring length required includes exclude manifest module equals xxxfile literal xxxfileliteral zipfileset set excludes setexcludes meta inf manifest zipfileset set excludes setexcludes meta inf manifest zipfileset set excludes setexcludes meta inf manifest zipfileset set excludes setexcludes meta inf manifest zip add zipfileset addzipfileset zipfileset handler log assembling module result get output file getoutputfile verbose handler log known antecedants knownantecedants execute task executetask zip build exception buildexception handler log exception logexception build exception buildexception zipping module result clear out of date clearoutofdate org aspectj internal tools ant taskdefs builder build installer buildinstaller build spec buildspec string build installer buildinstaller build spec buildspec build spec buildspec string targ dir path targdirpath task execute advice execute task executetask task task building enabled buildingenabled task execute support compiling basic aspect j aspectj projects projects compile source directories aspectpath inpath supported load compiler assumes user defined project property aspectj exists code module dir lib aspectj lib aspectj tools jar code aspect jsupport aspectjsupport string ajctask org aspectj tools ant taskdefs ajc task ajctask string aspectjrt jar variable aspectjrt lib string libaspectj rpath lib aspectj map name to aspectjrtjar nametoaspectjrtjar hash map hashmap string module compiled aspect j aspectj task param module module compile param javac javac compile commands javac task compile aspect j aspectj needed task wrap if needed wrapifneeded result result javac javac project project javac get project getproject path runtime jar runtimejar module module result get module getmodule runtime jar on classpath runtimejaronclasspath result aspectjrt jar classpath result get classpath variables getclasspathvariables aspectjrt jar variable variables find aspectjrt jar add classpath runtime jar runtimejar get aspect jlib getaspectjlib project module aspectjrt jar system println javac result javac get classpath getclasspath javac system println aspectj result javac get classpath getclasspath path aspectjtools jar aspectjtoolsjar get aspect jlib getaspectjlib project module aspectjtools jar aspect jtask aspectjtask javac aspectjtools jar aspectjtoolsjar runtime jar runtimejar aspectjrt jar classpath runtime jar on classpath runtimejaronclasspath result result iterator iter result get lib jars getlibjars iterator iter has next hasnext file file file iter aspectjrt jar equals file get name getname path get aspect jlib getaspectjlib project project module module string path result string lib dir names libdirnames aspectj aspectj libaspectj rpath string lib dirs libdirs string lib dir names libdirnames length lib dir names libdirnames length libaspectj rpath lib dir names libdirnames lib dirs libdirs module get full path getfullpath libaspectj rpath lib dirs libdirs project get property getproperty lib dir names libdirnames lib dirs libdirs lib dirs libdirs util path lib dirs libdirs lib result path project util path lib dirs libdirs string path result to string tostring file path can read canread result string unable find arrays as list aslist lib dirs libdirs build exception buildexception wrap aspect j aspectj compiler task works javac source compilation src dir srcdir written reflectively compile build module depend tree param javac javac specification param tools jar toolsjar path aspectjtools jar param runtime jar runtimejar path aspectjrt jar javac task invoking aspect j aspectj compiler task aspect jtask aspectjtask javac javac path tools jar toolsjar path runtime jar runtimejar object task string url url file tools jar toolsjar to string tostring replace url url url url class loader classloader parent task get class loader getclassloader class loader classloader loader urlclass loader urlclassloader parent loader load class loadclass ajctask task new instance newinstance project project javac get project getproject method get method getmethod setup ajc setupajc javac invoke task object javac get method getmethod set fork setfork invoke task object get method getmethod set forkclasspath setforkclasspath path invoke task object tools jar toolsjar get method getmethod set source roots setsourceroots path invoke task object javac get srcdir getsrcdir runtime jar runtimejar get method getmethod set classpath setclasspath path invoke task object runtime jar runtimejar build exception buildexception throwable string buffer stringbuffer string buffer stringbuffer append classpath append url build exception buildexception to string tostring task task aspect jsupport aspectjsupport error instances product builder productbuilder ant builder antbuilder string get product install resources src getproductinstallresourcessrc build spec buildspec build spec buildspec xxxfile literal xxxfileliteral string resources name resourcesname installer resources file dir build spec buildspec product dir productdir get parent file getparentfile dir util path string resources name resourcesname dir dir get parent file getparentfile dir util path resources name resourcesname dir file dir resources name resourcesname dir get path getpath string get product installer file name getproductinstallerfilename build spec buildspec build spec buildspec xxxfile literal xxxfileliteral aspectj build spec buildspec product dir productdir get name getname util short version shortversion build spec buildspec version jar calculate main typically initial cap initialcap installer installer org aspectj product name productname installer string get product installer main class getproductinstallermainclass build spec buildspec build spec buildspec string product name productname build spec buildspec product dir productdir get name getname string initial product name productname substring to upper case touppercase product name productname initial product name productname substring xxxname literal xxxnameliteral installer org aspectj product name productname installer builder get builder getbuilder string project file product builder productbuilder project project file temp dir tempdir use eclipse compiles useeclipsecompiles messager handler project temp dir tempdir use eclipse compiles useeclipsecompiles handler delegate build product buildproduct template method copy binaries copybinaries build spec buildspec build spec buildspec file dist dir distdir file targ dir targdir string excludes copy copy make copy task makecopytask copy set todir settodir targ dir targdir file set fileset fileset file set fileset fileset set dir setdir dist dir distdir fileset set includes setincludes builder binary source pattern excludes fileset set excludes setexcludes excludes copy add fileset addfileset fileset execute task executetask copy delegate build product buildproduct template method copy non binaries copynonbinaries build spec buildspec build spec buildspec file dist dir distdir file targ dir targdir filter copy binaries copy copy make copy task makecopytask copy set todir settodir targ dir targdir util iax if not can read dir iaxifnotcanreaddir dist dir distdir product dist directory file set fileset fileset file set fileset fileset set dir setdir dist dir distdir fileset set excludes setexcludes builder binary source pattern copy add fileset addfileset fileset execute task executetask copy build installer buildinstaller build spec buildspec build spec buildspec string targ dir path targdirpath build spec buildspec verbose handler log creating installer build spec buildspec ajinstaller installer ajinstaller setup task setuptask installer installer installer set basedir setbasedir targ dir path targdirpath installer set compress setcompress xxxfile literal xxxfileliteral file install src dir installsrcdir file build spec buildspec product dir productdir install util iax if not can read dir iaxifnotcanreaddir install src dir installsrcdir install src dir installsrcdir installer set html src sethtmlsrc install src dir installsrcdir get path getpath string resource path resourcepath get product install resources src getproductinstallresourcessrc build spec buildspec file resource src dir resourcesrcdir file resource path resourcepath util iax if not can read dir iaxifnotcanreaddir resource src dir resourcesrcdir resource src dir resourcesrcdir installer set resources src setresourcessrc resource path resourcepath string get product installer file name getproductinstallerfilename build spec buildspec file out file outfile file build spec buildspec jar dir jardir installer set zipfile setzipfile out file outfile get path getpath installer set mainclass setmainclass get product installer main class getproductinstallermainclass build spec buildspec installer set installerclassjar setinstallerclassjar get build jar getbuildjar build spec buildspec execute task executetask installer test installer xxx create text setup file installer setup file cleanup installed product string get build jar getbuildjar build spec buildspec build spec buildspec build spec buildspec base dir basedir get path getpath xxx lib build build jar module module for replace file moduleforreplacefile file replace file replacefile modules modules string jar name jarname module alias for modulealiasfor replace file replacefile get name getname to lower case tolowercase jar name jarname ends with endswith jar jar name jarname ends with endswith zip xxxfile literal xxxfileliteral jar name jarname jar name jarname substring jar name jarname length illegal argument exception illegalargumentexception replace jar zip assemble all assembleall jar name jarname ends with endswith string assemble all assembleall jar name jarname jar name jarname substring jar name jarname length modules get module getmodule project messager projectmessager messager project project project messager projectmessager project project util iax if null iaxifnull project project project project log string project log error string project log project msg err log exception logexception string context throwable thrown project log context util render exception renderexception thrown project msg err