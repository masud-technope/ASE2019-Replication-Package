copyright xerox corporation palo alto center incorporated parc rights reserved program accompanying materials terms common license accompanies distribution http eclipse org legal cpl html contributors xerox parc initial implementation xxx includes code ant apache license org aspectj internal tools ant taskdefs java byte array input stream bytearrayinputstream java byte array output stream bytearrayoutputstream java file java file input stream fileinputstream java file output stream fileoutputstream java ioexception java input stream inputstream java string buffer input stream stringbufferinputstream java util array list arraylist java util iterator java util list java util zip crc java util zip zip entry zipentry java util zip zip output stream zipoutputstream org apache tools ant build exception buildexception org apache tools ant directory scanner directoryscanner org apache tools ant project org apache tools ant taskdefs copy org apache tools ant taskdefs delete org apache tools ant taskdefs expand org apache tools ant taskdefs matching task matchingtask org apache tools ant types file set fileset org apache tools ant types pattern set patternset ajinstaller matching task matchingtask string include classes installer org aspectj string main installer org aspectj main string contents file installer org aspectj resources contents txt string html src htmlsrc set html src sethtmlsrc string html src htmlsrc string resources src resourcessrc set resources src setresourcessrc string resources src resourcessrc string mainclass set mainclass setmainclass string mainclass file installer class jar installerclassjar set installerclassjar setinstallerclassjar string installer class jar installerclassjar project resolve file resolvefile list contents names contentsnames array list arraylist contents bytes contentsbytes add to contents addtocontents file file string v path vpath contents names contentsnames add v path vpath contents bytes contentsbytes file length string get files getfiles file base dir basedir directory scanner directoryscanner directory scanner directoryscanner set basedir setbasedir base dir basedir get absolute path getabsolutepath set basedir setbasedir base dir basedir set includes setincludes string pattern scan get included files getincludedfiles copy get copy task getcopytask copy copy project create task createtask copy log project create task createtask copy failed direct project msg verbose copy set project setproject get project getproject finish zip output stream finishzipoutputstream zip output stream zipoutputstream z out zout ioexception build exception buildexception write contents writecontents z out zout write manifest writemanifest z out zout file temp dir tempdir setup temp dir setuptempdir string tmp temp dir tempdir get absolute path getabsolutepath installer files expand expand expand expand set project setproject get project getproject expand set src setsrc installer class jar installerclassjar expand set dest setdest file tmp pattern set patternset patterns pattern set patternset patterns set includes setincludes include classes expand add patternset addpatternset patterns expand execute move correct resource files jar copy get copy task getcopytask fileset file set fileset fileset set dir setdir file resources src resourcessrc fileset set includes setincludes fileset set excludes setexcludes contents txt properties txt add fileset addfileset fileset set todir settodir file tmp installer org aspectj resources execute project get global filter set getglobalfilterset add filter addfilter installer main mainclass copy get copy task getcopytask fileset file set fileset fileset set dir setdir file resources src resourcessrc fileset set includes setincludes properties txt set filtering setfiltering add fileset addfileset fileset set todir settodir file tmp installer org aspectj resources execute move correct resource files jar get copy task getcopytask fileset file set fileset fileset set dir setdir file html src htmlsrc fileset set includes setincludes add fileset addfileset fileset set todir settodir file tmp installer org aspectj resources execute move files jar set basedir setbasedir tmp write files writefiles z out zout get files getfiles temp dir tempdir delete tmp dir delete delete project create task createtask delete delete set project setproject get project getproject set dir setdir temp dir tempdir execute temp dir tempdir newline write contents writecontents zip output stream zipoutputstream z out zout ioexception write string buffer stringbuffer string buffer stringbuffer buf string buffer stringbuffer buf append contents bytes contentsbytes buf append newline iterator contents names contentsnames iterator has next hasnext string string buf append buf append newline zip file zipfile string buffer input stream stringbufferinputstream buf to string tostring z out zout contents file system current time millis currenttimemillis write manifest writemanifest zip output stream zipoutputstream z out zout ioexception write string buffer stringbuffer string buffer stringbuffer buf string buffer stringbuffer buf append manifest version buf append newline buf append main main buf append newline zip file zipfile string buffer input stream stringbufferinputstream buf to string tostring z out zout meta inf manifest system current time millis currenttimemillis xxx cut paste zip apache license file zip file zipfile file base dir basedir do compress docompress string archive type archivetype zip location create zip file set zipfile setzipfile string zip filename zipfilename zip file zipfile project resolve file resolvefile zip filename zipfilename base directory zip set basedir setbasedir string base dirname basedirname base dir basedir project resolve file resolvefile base dirname basedirname sets compress files store set compress setcompress string compress do compress docompress project to boolean toboolean compress init zip output stream initzipoutputstream zip output stream zipoutputstream z out zout ioexception build exception buildexception zip dir zipdir file dir zip output stream zipoutputstream z out zout string v path vpath ioexception zip file zipfile input stream inputstream zip output stream zipoutputstream z out zout string v path vpath last modified lastmodified ioexception zip entry zipentry zip entry zipentry v path vpath set time settime last modified lastmodified xxx zip output stream zipoutputstream put entry putentry expects zip entry zipentry size crc sum start writing data stored mode forces process data couldn find documentation error do compress docompress size crc cal crc mark supported marksupported store data byte array output stream bytearrayoutputstream bos byte array output stream bytearrayoutputstream buffer count size count cal update buffer count bos write buffer count count read buffer buffer length count byte array input stream bytearrayinputstream bos to byte array tobytearray mark integer max buffer count size count cal update buffer count count read buffer buffer length count reset set size setsize size set crc setcrc cal get value getvalue z out zout put next entry putnextentry buffer count z out zout write buffer count count read buffer buffer length count zip file zipfile file file zip output stream zipoutputstream z out zout string v path vpath ioexception v path vpath starts with startswith installer add to contents addtocontents file v path vpath file input stream fileinputstream f in fin file input stream fileinputstream file zip file zipfile f in fin z out zout v path vpath file last modified lastmodified f in fin close file setup temp dir setuptempdir build exception buildexception file tmp dir f tmpdirf file tmp dir tmpdir tmp dir f tmpdirf file create temp file createtempfile tgz tmp dir tmpdir file tmp dir f tmpdirf get parent file getparentfile ajinstaller tmp dir f tmpdirf delete ioexception tmp dir tmpdir tmp dir tmpdir mkdirs tmp dir tmpdir file ajinstaller finish zip output stream finishzipoutputstream tmp tmp dir tmpdir mkdirs build exception buildexception unable temp dir tmp dir tmpdir execute build exception buildexception installer class jar installerclassjar build exception buildexception installer class jar installerclassjar attribute installer class jar installerclassjar can read canread installer class jar installerclassjar get path getpath ends with endswith jar build exception buildexception readable jar installer class jar installerclassjar base dir basedir build exception buildexception basedir attribute base dir basedir exists build exception buildexception basedir exist directory scanner directoryscanner get directory scanner getdirectoryscanner base dir basedir string files get included files getincludedfiles string dirs get included directories getincludeddirectories log building installer zip file zipfile get absolute path getabsolutepath zip output stream zipoutputstream z out zout z out zout zip output stream zipoutputstream file output stream fileoutputstream zip file zipfile do compress docompress z out zout set method setmethod zip output stream zipoutputstream deflated z out zout set method setmethod zip output stream zipoutputstream stored init zip output stream initzipoutputstream z out zout write dirs writedirs z out zout dirs write files writefiles z out zout files deletes temp dir finish zip output stream finishzipoutputstream z out zout ioexception ioe string msg problem creating archive type archivetype ioe get message getmessage build exception buildexception msg ioe location z out zout close z out zout close ioexception write dirs writedirs zip output stream zipoutputstream z out zout string dirs ioexception dirs length file file base dir basedir dirs string dirs replace file separator char separatorchar zip dir zipdir z out zout write files writefiles zip output stream zipoutputstream z out zout string files ioexception files length file file base dir basedir files string files replace file separator char separatorchar zip file zipfile z out zout